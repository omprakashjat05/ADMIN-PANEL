<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=700, initial-scale=0.6, maximum-scale=1.0, user-scalable=no" />
  <title>üî• GitHub Admin Panel - Enhanced</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
    
    :root {
      --bg-primary: #0a0a0a;
      --bg-secondary: #1f1f1f;
      --bg-card: #1e1e1e;
      --bg-input: #2d2d2d;
      --bg-hover: #252525;
      --accent: #ffc107;
      --accent-hover: #ffb300;
      --accent-light: rgba(255, 193, 7, 0.1);
      --text-primary: #f5f5f5;
      --text-secondary: #aaa;
      --border: #333;
      --success: #4caf50;
      --danger: #e53935;
      --warning: #ff9800;
      --expired-bg: #3d1a1a;
      --expired-border: #8b2020;
    }

    [data-theme="blue"] {
      --bg-primary: #0a1929;
      --bg-secondary: #1a2332;
      --bg-card: #1e2a3a;
      --bg-input: #2d3748;
      --bg-hover: #334155;
      --accent: #2196f3;
      --accent-hover: #1976d2;
      --accent-light: rgba(33, 150, 243, 0.1);
      --border: #3d4a5c;
    }

    [data-theme="green"] {
      --bg-primary: #0a1a0a;
      --bg-secondary: #1a2e1a;
      --bg-card: #1e331e;
      --bg-input: #2d482d;
      --bg-hover: #335533;
      --accent: #4caf50;
      --accent-hover: #388e3c;
      --accent-light: rgba(76, 175, 80, 0.1);
      --border: #3d5c3d;
    }

    [data-theme="purple"] {
      --bg-primary: #1a0a1a;
      --bg-secondary: #2e1a2e;
      --bg-card: #331e33;
      --bg-input: #482d48;
      --bg-hover: #553355;
      --accent: #9c27b0;
      --accent-hover: #7b1fa2;
      --accent-light: rgba(156, 39, 176, 0.1);
      --border: #5c3d5c;
    }

    [data-theme="red"] {
      --bg-primary: #1a0a0a;
      --bg-secondary: #2e1a1a;
      --bg-card: #331e1e;
      --bg-input: #482d2d;
      --bg-hover: #553333;
      --accent: #f44336;
      --accent-hover: #d32f2f;
      --accent-light: rgba(244, 67, 54, 0.1);
      --border: #5c3d3d;
    }

    [data-theme="gold"] {
      --bg-primary: #0a0a0a;
      --bg-secondary: #1f1f1f;
      --bg-card: #1e1e1e;
      --bg-input: #2d2d2d;
      --bg-hover: #252525;
      --accent: #ffc107;
      --accent-hover: #ffb300;
      --accent-light: rgba(255, 193, 7, 0.1);
      --border: #333;
    }
    
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, var(--bg-primary), var(--bg-secondary));
      color: var(--text-primary);
      min-height: 100vh;
      transition: all 0.5s ease;
    }
    
    header {
      background: var(--bg-card);
      padding: 15px 25px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 2px solid var(--border);
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      position: sticky;
      top: 0;
      z-index: 100;
      transition: all 0.5s ease;
    }
    
    header h1 {
      color: var(--accent);
      font-size: 1.5em;
      display: flex;
      align-items: center;
      gap: 10px;
      transition: color 0.5s ease;
    }
    
    .github-logo {
      width: 32px;
      height: 32px;
      fill: var(--accent);
      transition: fill 0.5s ease;
    }
    
    .user-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 2px solid var(--accent);
      transition: border-color 0.5s ease;
    }
    
    .user-details {
      text-align: right;
    }
    
    .user-name {
      font-weight: 600;
      color: var(--accent);
      font-size: 0.95em;
      transition: color 0.5s ease;
    }
    
    .user-username {
      font-size: 0.8em;
      color: var(--text-secondary);
    }
    
    .logout-btn, .settings-btn, .theme-btn {
      background: var(--danger);
      color: white;
      border: none;
      border-radius: 6px;
      padding: 8px 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .settings-btn {
      background: var(--bg-hover);
    }

    .theme-btn {
      background: var(--accent);
      color: #111;
      transition: all 0.5s ease;
    }
    
    .logout-btn:hover { background: #c62828; transform: scale(1.05); }
    .settings-btn:hover { background: var(--bg-input); }
    .theme-btn:hover { background: var(--accent-hover); }
    
    main {
      max-width: 1200px;
      margin: 30px auto;
      padding: 20px;
    }
    
    .card {
      background: var(--bg-card);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
      margin-bottom: 25px;
      transition: all 0.5s ease;
      border: 1px solid var(--border);
    }
    
    .card h3 {
      color: var(--accent);
      margin-bottom: 15px;
      font-size: 1.3em;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      user-select: none;
      transition: color 0.5s ease;
    }

    .card h3:hover {
      color: var(--accent-hover);
    }

    .collapse-icon {
      transition: transform 0.3s ease;
      font-size: 0.8em;
    }

    .collapse-icon.collapsed {
      transform: rotate(-90deg);
    }

    .collapsible-content {
      max-height: 2000px;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    .collapsible-content.collapsed {
      max-height: 0;
    }
    
    .login-card {
      max-width: 650px;
      margin: 50px auto;
    }
    
    .login-card p {
      color: var(--text-secondary);
      margin: 15px 0;
      line-height: 1.6;
    }
    
    .login-card ol {
      color: var(--text-secondary);
      margin: 15px 0 15px 20px;
      line-height: 1.8;
    }
    
    .login-card ol a {
      color: var(--accent);
      text-decoration: none;
      transition: color 0.5s ease;
    }
    
    .token-input-group {
      background: var(--bg-hover);
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
      transition: background 0.5s ease;
    }
    
    .token-input-group input, .token-input-group textarea {
      width: 100%;
      padding: 14px;
      background: var(--bg-input);
      color: var(--text-primary);
      border: 2px solid var(--border);
      border-radius: 8px;
      font-size: 14px;
      outline: none;
      transition: all 0.5s ease;
    }
    
    .token-input-group input[type="password"] {
      font-family: 'Courier New', monospace;
    }
    
    .token-input-group textarea {
      font-family: 'Poppins', sans-serif;
      min-height: 100px;
      resize: vertical;
    }
    
    .token-input-group input:focus, .token-input-group textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 10px var(--accent-light);
    }
    
    .token-input-group label {
      display: block;
      color: var(--accent);
      font-weight: 600;
      margin-bottom: 10px;
      transition: color 0.5s ease;
    }
    
    .login-btn {
      background: #238636;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 14px 28px;
      font-size: 1.1em;
      font-weight: 600;
      cursor: pointer;
      display: block;
      width: 100%;
      margin-top: 20px;
      transition: all 0.3s ease;
    }
    
    .login-btn:hover {
      background: #2ea043;
    }
    
    .repo-filter-info {
      background: var(--accent-light);
      border: 1px solid var(--accent);
      padding: 12px 15px;
      border-radius: 8px;
      margin-bottom: 15px;
      font-size: 0.9em;
      color: var(--text-secondary);
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.5s ease;
    }
    
    .repo-filter-info strong {
      color: var(--accent);
      transition: color 0.5s ease;
    }
    
    .repo-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    
    .repo-card {
      background: var(--bg-input);
      padding: 15px;
      border-radius: 8px;
      border: 2px solid var(--border);
      cursor: pointer;
      transition: all 0.5s ease;
    }
    
    .repo-card:hover {
      border-color: var(--accent);
      transform: translateY(-2px);
      box-shadow: 0 4px 15px var(--accent-light);
    }
    
    .repo-card.active {
      border-color: var(--accent);
      background: var(--accent-light);
      box-shadow: 0 0 20px var(--accent-light);
    }
    
    .repo-name {
      font-weight: 600;
      color: var(--accent);
      margin-bottom: 5px;
      font-size: 0.95em;
      transition: color 0.5s ease;
    }
    
    .repo-description {
      font-size: 0.85em;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }
    
    .repo-stats {
      display: flex;
      gap: 15px;
      font-size: 0.8em;
      color: #888;
    }
    
    .file-selector select {
      width: 100%;
      padding: 12px;
      background: var(--bg-input);
      color: var(--text-primary);
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 1em;
      cursor: pointer;
      outline: none;
      margin-top: 15px;
      transition: all 0.5s ease;
    }
    
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      border-bottom: 2px solid var(--border);
      transition: border-color 0.5s ease;
    }
    
    .tab {
      padding: 12px 24px;
      background: transparent;
      border: none;
      color: var(--text-secondary);
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: all 0.3s ease;
    }
    
    .tab:hover { color: var(--accent); }
    .tab.active { 
      color: var(--accent); 
      border-bottom-color: var(--accent);
    }
    
    .tab-content { display: none; }
    .tab-content.active { display: block; animation: fadeIn 0.3s ease; }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes highlightPulse {
      0%, 100% { box-shadow: 0 0 0 0 var(--accent); }
      50% { box-shadow: 0 0 20px 5px var(--accent-light); }
    }

    .item.highlight {
      animation: highlightPulse 2s ease-in-out 3;
      border-color: var(--accent) !important;
      background: var(--accent-light) !important;
    }
    
    input, button, select, textarea {
      padding: 10px;
      margin: 8px 6px;
      border-radius: 8px;
      border: none;
      font-size: 15px;
      transition: all 0.5s ease;
    }
    
    input, textarea {
      background: var(--bg-input);
      color: var(--text-primary);
      border: 1px solid var(--border);
      outline: none;
    }
    
    input { 
      width: calc(100% - 12px);
      max-width: 100%;
    }
    
    textarea {
      width: calc(100% - 12px);
      min-height: 400px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      resize: vertical;
      line-height: 1.5;
    }
    
    button { cursor: pointer; font-weight: 600; }
    button.save { background: #007bff; color: #fff; }
    button.update { background: #43a047; color: #fff; }
    button.danger { background: var(--danger); color: #fff; }
    button.sync { background: var(--warning); color: #fff; }
    
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 15px;
    }
    
    .item {
      background: var(--bg-hover);
      padding: 15px;
      border-radius: 10px;
      border: 2px solid var(--border);
      position: relative;
      transition: all 0.5s ease;
      scroll-margin-top: 100px;
    }

    .item:hover {
      border-color: var(--accent);
      transform: translateY(-2px);
    }

    .item.expired {
      background: var(--expired-bg);
      border-color: var(--expired-border);
    }

    .item.expired:hover {
      border-color: var(--danger);
    }

    .item.expired .position-badge {
      background: var(--danger);
    }

    .item.expired::before {
      content: "‚ö†Ô∏è EXPIRED";
      position: absolute;
      top: 10px;
      left: 10px;
      background: var(--danger);
      color: white;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 700;
      z-index: 1;
    }
    
    .item p { margin: 6px 0; font-size: 14px; color: #ddd; }
    .item b { 
      color: var(--accent);
      transition: color 0.5s ease;
    }
    
    .position-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      background: var(--accent);
      color: #111;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      transition: all 0.5s ease;
    }
    
    .btn-group {
      margin-top: 10px;
      display: flex;
      justify-content: space-between;
      gap: 8px;
    }
    
    .status-bar {
      background: var(--bg-input);
      padding: 12px 18px;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 10px;
      transition: all 0.5s ease;
      border: 1px solid var(--border);
    }
    
    .status-bar .status {
      color: var(--success);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .status-bar .actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .info-box {
      background: var(--accent-light);
      border: 1px solid var(--accent);
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
      transition: all 0.5s ease;
    }
    
    .info-box p { color: var(--text-secondary); margin: 8px 0; line-height: 1.6; }
    
    .warning-box {
      background: rgba(255, 152, 0, 0.1);
      border: 1px solid var(--warning);
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
      transition: all 0.5s ease;
    }
    
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #666;
    }

    .search-box {
      position: relative;
      margin: 15px 6px;
    }

    .search-box input {
      width: 100%;
      padding-left: 40px;
      background: var(--bg-input);
      border: 2px solid var(--border);
    }

    .search-box input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 10px var(--accent-light);
    }

    .search-icon {
      position: absolute;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-secondary);
      pointer-events: none;
    }

    .position-input-group {
      display: flex;
      gap: 10px;
      align-items: center;
      margin: 10px 6px;
      flex-wrap: wrap;
    }

    .position-input-group label {
      color: var(--accent);
      font-weight: 600;
      white-space: nowrap;
      transition: color 0.5s ease;
    }

    .position-input-group input {
      flex: 1;
      min-width: 200px;
      margin: 0;
    }

    /* Form Input Styling */
    #deviceId, #key, #username {
      width: calc(100% - 12px) !important;
      max-width: 100%;
    }

    .position-input-group {
      width: 100%;
    }

    .position-input-group > div {
      flex: 1;
      max-width: 100%;
    }

    .position-suggestions {
      position: absolute;
      background: var(--bg-input);
      border: 2px solid var(--accent);
      border-radius: 8px;
      max-height: 200px;
      overflow-y: auto;
      z-index: 1000;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
      display: none;
      transition: all 0.5s ease;
    }

    .position-suggestions.show {
      display: block;
    }

    .position-suggestion-item {
      padding: 10px 15px;
      cursor: pointer;
      transition: background 0.2s ease;
      border-bottom: 1px solid var(--border);
    }

    .position-suggestion-item:hover {
      background: var(--bg-hover);
    }

    .position-suggestion-item:last-child {
      border-bottom: none;
    }

    .suggestion-position {
      color: var(--accent);
      font-weight: 600;
      margin-right: 10px;
      transition: color 0.5s ease;
    }

    .suggestion-user {
      color: var(--text-secondary);
      font-size: 0.9em;
    }

    /* Quick Date Selection Styles */
    .date-input-wrapper {
      display: flex;
      align-items: center;
      gap: 8px;
      width: calc(100% - 12px);
      margin: 8px 6px;
    }

    .date-input-wrapper input {
      flex: 1;
      margin: 0;
      width: 100%;
      min-width: 150px;
    }

    .quick-date-buttons {
      display: flex;
      gap: 4px;
    }

    .quick-date-btn {
      background: var(--accent);
      color: #111;
      border: none;
      border-radius: 6px;
      padding: 8px 10px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
      margin: 0;
    }

    .quick-date-btn:hover {
      background: var(--accent-hover);
      transform: scale(1.05);
    }

    .quick-date-btn:active {
      transform: scale(0.95);
    }

    .theme-modal {
      display: none;
      position: fixed;
      z-index: 2000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.7);
      animation: fadeIn 0.3s ease;
    }

    .theme-modal-content {
      background: var(--bg-card);
      margin: 10% auto;
      padding: 30px;
      border: 2px solid var(--accent);
      border-radius: 15px;
      width: 90%;
      max-width: 500px;
      animation: slideDown 0.3s ease;
      transition: all 0.5s ease;
    }

    @keyframes slideDown {
      from { transform: translateY(-50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .theme-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .theme-option {
      padding: 20px;
      border-radius: 10px;
      border: 3px solid transparent;
      cursor: pointer;
      text-align: center;
      transition: all 0.3s ease;
      font-weight: 600;
    }

    .theme-option:hover {
      transform: scale(1.05);
    }

    .theme-option.active {
      border-color: white;
      box-shadow: 0 0 20px rgba(255,255,255,0.3);
    }

    .theme-gold { background: linear-gradient(135deg, #ffc107, #ffb300); color: #111; }
    .theme-blue { background: linear-gradient(135deg, #2196f3, #1976d2); color: white; }
    .theme-green { background: linear-gradient(135deg, #4caf50, #388e3c); color: white; }
    .theme-purple { background: linear-gradient(135deg, #9c27b0, #7b1fa2); color: white; }
    .theme-red { background: linear-gradient(135deg, #f44336, #d32f2f); color: white; }
    
    footer {
      text-align: center;
      color: #888;
      padding: 20px;
      font-size: 0.9em;
    }
    
    /* COMPACT INPUT FIX */
#tab-keys #deviceId,
#tab-keys #key,
#tab-keys #username,
#tab-keys #expiry,
#tab-keys #positionInput {
    max-width: 360px !important;
    width: 100% !important;
}

/* Mobile me aur chota */
@media (max-width: 600px) {
  #tab-keys #deviceId,
  #tab-keys #key,
  #tab-keys #username,
  #tab-keys #expiry,
  #tab-keys #positionInput {
      max-width: 280px !important;
  }
}
  </style>
</head>
<body data-theme="gold">
  <header>
    <h1>
      <svg class="github-logo" viewBox="0 0 16 16">
        <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
      </svg>
      GitHub Admin Panel
    </h1>
    <div class="user-info" id="userInfo" style="display:none;">
      <div class="user-details">
        <div class="user-name" id="userName"></div>
        <div class="user-username" id="userUsername"></div>
      </div>
      <img class="user-avatar" id="userAvatar" src="" alt="Avatar">
      <button class="theme-btn" id="themeBtn">üé® Theme</button>
      <button class="logout-btn" id="logoutBtn">üö™ Logout</button>
    </div>
  </header>

  <main>
    <!-- Login Section -->
    <div id="loginSection">
      <div class="card login-card">
        <h3>üîê GitHub Access Token Login</h3>
        
        <div class="info-box">
          <p><strong>‚ö†Ô∏è Token Generate Steps:</strong></p>
        </div>
        
        <ol>
          <li>GitHub: <a href="https://github.com/settings/tokens" target="_blank">https://github.com/settings/tokens</a></li>
          <li><strong>"Generate new token (classic)"</strong></li>
          <li>Permissions: <strong>‚úÖ repo</strong></li>
          <li>Generate & copy token</li>
        </ol>
        
        <div class="token-input-group">
          <label>üîë GitHub Personal Access Token:</label>
          <input type="password" id="tokenInput" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx" />
        </div>
        
        <div class="token-input-group">
          <label>üìÅ Repository Filter (optional):</label>
          <textarea id="repoFilterInput" placeholder="Repository names (comma or new line separated):

repo1, repo2, repo3

or

repo1
repo2
repo3"></textarea>
        </div>
        
        <button class="login-btn" id="loginBtn">üöÄ Connect to GitHub</button>
      </div>
    </div>

    <!-- Main Panel -->
    <div id="mainPanel" style="display:none;">
      <div class="card">
        <h3 onclick="toggleCollapse('repoSection')">
          üìÅ Select Repository & File
          <span class="collapse-icon" id="repoSectionIcon">‚ñº</span>
        </h3>
        
        <div class="collapsible-content" id="repoSection">
          <div class="repo-filter-info" id="filterInfo" style="display:none;">
            <div>
              <strong>üîç Filter:</strong> <span id="filterCount">0</span> repos
            </div>
          </div>
          
          <div class="status-bar">
            <div class="status" id="repoStatus">‚ö° Ready</div>
            <div class="actions">
              <button class="sync" id="filterBtn" style="margin: 0;">üîç Filter</button>
              <button class="sync" id="refreshReposBtn" style="margin: 0;">üîÑ Refresh</button>
            </div>
          </div>
          
          <div class="repo-grid" id="repoGrid"></div>
          
          <div class="file-selector" id="fileSelector" style="display:none;">
            <label style="color: var(--accent); font-weight: 600; display: block; margin: 10px 6px;">Select JSON File:</label>
            <select id="fileSelect">
              <option value="">-- Select a JSON file --</option>
            </select>
          </div>
        </div>
      </div>

      <div class="card" id="mainContent" style="display:none;">
        <div class="status-bar">
          <div class="status" id="syncStatus">‚ö° Ready</div>
          <div style="color: var(--text-secondary); font-size: 0.9em;">
            <span id="currentRepo">No repo selected</span> ‚Ä¢ 
            <span id="lastSync">Not synced</span>
          </div>
        </div>

        <div class="tabs">
          <button class="tab active" data-tab="keys">üìú Active Keys</button>
          <button class="tab" data-tab="editor">üìù Raw JSON Editor</button>
        </div>

        <div class="tab-content active" id="tab-keys">
          <div class="card" style="background: var(--bg-hover);">
            <h3>‚ûï Add / Update License Key</h3>
            <div style="display: flex; flex-direction: column; gap: 0;">
              <input type="text" id="deviceId" placeholder="Device ID" style="width: calc(100% - 12px);">
              <input type="text" id="key" placeholder="Key" style="width: calc(100% - 12px);">
              <div class="date-input-wrapper">
                <input type="text" id="expiry" placeholder="Expiry (dd-mm-yyyy)" value="01-01-2026">
                <div class="quick-date-buttons">
                  <button class="quick-date-btn" onclick="setQuickDate(7)">7d</button>
                  <button class="quick-date-btn" onclick="setQuickDate(15)">15d</button>
                  <button class="quick-date-btn" onclick="setQuickDate(30)">30d</button>
                </div>
              </div>
              <input type="text" id="username" placeholder="User name" style="width: calc(100% - 12px);">
              <label style="color: var(--accent); margin: 8px 6px;">
                <input type="checkbox" id="allowOffline" style="width: auto;"> Allow Offline
              </label>
            </div>
            <div class="position-input-group">
              <label>üìç Position:</label>
              <div style="position: relative; flex: 1;">
                <input type="text" id="positionInput" placeholder="Type position number or search user..." autocomplete="off" />
                <div class="position-suggestions" id="positionSuggestions"></div>
              </div>
              <span id="positionInfo" style="color: var(--text-secondary); font-size: 0.9em;"></span>
            </div>
            <button id="saveBtn" class="save">üíæ Save to GitHub</button>
            <button id="cancelBtn" class="danger" style="display:none;">‚ùå Cancel</button>
          </div>

          <div class="card" style="background: var(--bg-hover);">
            <h3>üìã License Keys</h3>
            
            <div style="margin: 15px 6px; color: var(--text-secondary); font-size: 0.95em; font-weight: 600;">
              <span id="keysCountInfo">Total: 0 | Active: 0 | Expired: 0</span>
            </div>
            
            <div class="tabs" style="margin-top: 10px;">
              <button class="tab active filter-tab" data-filter="all">üìú All Keys</button>
              <button class="tab filter-tab" data-filter="active">‚úÖ Active</button>
              <button class="tab filter-tab" data-filter="expired">‚ö†Ô∏è Expired</button>
            </div>
            
            <div class="search-box">
              <span class="search-icon">üîç</span>
              <input type="text" id="searchInput" placeholder="Search by Device ID, User, or Key...">
            </div>
            
            <div id="dataList" class="grid"></div>
          </div>
        </div>

        <div class="tab-content" id="tab-editor">
          <div class="card" style="background: var(--bg-hover);">
            <h3>üìù Edit Raw JSON</h3>
            <textarea id="rawJsonEditor" placeholder="JSON data will appear here..."></textarea>
            <div style="display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap;">
              <button class="update" id="updateFromJsonBtn">üì§ Save JSON</button>
              <button class="sync" id="formatJsonBtn">‚ú® Format</button>
              <button class="sync" id="copyJsonBtn">üìã Copy</button>
              <button class="danger" id="resetJsonBtn">üîÑ Reset</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Theme Modal -->
  <div id="themeModal" class="theme-modal">
    <div class="theme-modal-content">
      <h3 style="color: var(--accent); margin-bottom: 20px;">üé® Choose Theme</h3>
      <div class="theme-grid">
        <div class="theme-option theme-gold" data-theme="gold">
          <div>üåü Gold</div>
        </div>
        <div class="theme-option theme-blue" data-theme="blue">
          <div>üíô Blue</div>
        </div>
        <div class="theme-option theme-green" data-theme="green">
          <div>üíö Green</div>
        </div>
        <div class="theme-option theme-purple" data-theme="purple">
          <div>üíú Purple</div>
        </div>
        <div class="theme-option theme-red" data-theme="red">
          <div>‚ù§Ô∏è Red</div>
        </div>
      </div>
      <button class="danger" onclick="closeThemeModal()" style="width: 100%; margin-top: 20px;">Close</button>
    </div>
  </div>

  <footer>¬© 2025 GitHub Admin Panel | By OP Mods</footer>

  <script>
    let accessToken = null;
    let userData = null;
    let repositories = [];
    let repoFilter = [];
    let selectedRepo = null;
    let selectedFile = null;
    let currentData = {};
    let currentUpdateId = null;
    let fileSha = null;
    let allDataArray = [];
    let filteredDataArray = [];
    let currentFilter = 'all'; // all, active, expired

    const loginSection = document.getElementById('loginSection');
    const mainPanel = document.getElementById('mainPanel');
    const userInfo = document.getElementById('userInfo');
    const repoGrid = document.getElementById('repoGrid');
    const fileSelector = document.getElementById('fileSelector');
    const fileSelect = document.getElementById('fileSelect');
    const mainContent = document.getElementById('mainContent');
    const dataList = document.getElementById('dataList');
    const rawJsonEditor = document.getElementById('rawJsonEditor');
    const tokenInput = document.getElementById('tokenInput');
    const repoFilterInput = document.getElementById('repoFilterInput');
    const filterInfo = document.getElementById('filterInfo');
    const filterCount = document.getElementById('filterCount');
    const searchInput = document.getElementById('searchInput');
    const positionInput = document.getElementById('positionInput');
    const positionSuggestions = document.getElementById('positionSuggestions');
    const expiryInput = document.getElementById('expiry');

    // Quick Date Selection Function
    window.setQuickDate = function(days) {
      const today = new Date();
      today.setDate(today.getDate() + days);
      
      const day = String(today.getDate()).padStart(2, '0');
      const month = String(today.getMonth() + 1).padStart(2, '0');
      const year = today.getFullYear();
      
      expiryInput.value = `${day}-${month}-${year}`;
      
      // Add visual feedback
      expiryInput.style.borderColor = 'var(--success)';
      setTimeout(() => {
        expiryInput.style.borderColor = '';
      }, 500);
    };

    // Helper function to check if date is expired
    function isExpired(expiryDate) {
      if (!expiryDate) return false;
      
      try {
        // Parse dd-mm-yyyy format
        const parts = expiryDate.split('-');
        if (parts.length !== 3) return false;
        
        const day = parseInt(parts[0]);
        const month = parseInt(parts[1]) - 1; // Month is 0-indexed
        const year = parseInt(parts[2]);
        
        const expiry = new Date(year, month, day);
        const today = new Date();
        today.setHours(0, 0, 0, 0); // Reset time to start of day
        
        return expiry < today;
      } catch (e) {
        return false;
      }
    }

    // Helper function to scroll to element smoothly
    function scrollToElement(element) {
      element.scrollIntoView({ 
        behavior: 'smooth', 
        block: 'center'
      });
    }

    // Helper function to highlight element
    function highlightElement(element) {
      element.classList.add('highlight');
      setTimeout(() => {
        element.classList.remove('highlight');
      }, 6000); // Remove after 6 seconds (3 pulses √ó 2 seconds)
    }

    // Theme functionality
    function loadTheme() {
      const savedTheme = localStorage.getItem('theme') || 'gold';
      document.body.dataset.theme = savedTheme;
      updateActiveTheme(savedTheme);
    }

    function updateActiveTheme(theme) {
      document.querySelectorAll('.theme-option').forEach(opt => {
        opt.classList.remove('active');
        if (opt.dataset.theme === theme) {
          opt.classList.add('active');
        }
      });
    }

    document.getElementById('themeBtn').addEventListener('click', () => {
      document.getElementById('themeModal').style.display = 'block';
    });

    window.closeThemeModal = function() {
      document.getElementById('themeModal').style.display = 'none';
    };

    document.querySelectorAll('.theme-option').forEach(option => {
      option.addEventListener('click', () => {
        const theme = option.dataset.theme;
        document.body.dataset.theme = theme;
        localStorage.setItem('theme', theme);
        updateActiveTheme(theme);
      });
    });

    // Collapse functionality
    window.toggleCollapse = function(sectionId) {
      const section = document.getElementById(sectionId);
      const icon = document.getElementById(sectionId + 'Icon');
      
      section.classList.toggle('collapsed');
      icon.classList.toggle('collapsed');
    };

    // Filter tabs functionality
    document.querySelectorAll('.filter-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        // Update active tab
        document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        // Update current filter
        currentFilter = tab.dataset.filter;
        
        // Redisplay data with current search term
        displayData(searchInput.value);
      });
    });

    // Load theme on page load
    loadTheme();

    checkExistingSession();

    function checkExistingSession() {
      const token = localStorage.getItem('github_token');
      const filter = localStorage.getItem('repo_filter');
      
      if (token) {
        accessToken = token;
        if (filter) {
          repoFilter = JSON.parse(filter);
        }
        initializeApp();
      }
    }

    document.getElementById('loginBtn').addEventListener('click', async () => {
      const token = tokenInput.value.trim();
      
      if (!token) {
        alert('‚ö†Ô∏è Please enter GitHub token!');
        return;
      }
      
      if (!token.startsWith('ghp_') && !token.startsWith('github_pat_')) {
        alert('‚ö†Ô∏è Invalid token format!');
        return;
      }
      
      const filterText = repoFilterInput.value.trim();
      if (filterText) {
        repoFilter = filterText.split(/[,\n]/).map(line => line.trim()).filter(line => line.length > 0);
        localStorage.setItem('repo_filter', JSON.stringify(repoFilter));
      } else {
        repoFilter = [];
        localStorage.removeItem('repo_filter');
      }
      
      accessToken = token;
      localStorage.setItem('github_token', accessToken);
      
      try {
        await initializeApp();
      } catch (error) {
        alert('‚ùå Invalid token: ' + error.message);
        localStorage.removeItem('github_token');
        accessToken = null;
      }
    });

    async function initializeApp() {
      try {
        await fetchUserData();
        await fetchRepositories();
        
        loginSection.style.display = 'none';
        mainPanel.style.display = 'block';
        userInfo.style.display = 'flex';
      } catch (error) {
        console.error('Init error:', error);
        throw error;
      }
    }

    async function fetchUserData() {
      const response = await fetch('https://api.github.com/user', {
        headers: {
          'Authorization': `token ${accessToken}`,
          'Accept': 'application/vnd.github.v3+json'
        }
      });

      if (!response.ok) throw new Error('Failed to fetch user');
      
      userData = await response.json();
      document.getElementById('userName').textContent = userData.name || userData.login;
      document.getElementById('userUsername').textContent = '@' + userData.login;
      document.getElementById('userAvatar').src = userData.avatar_url;
    }

    async function fetchRepositories() {
      updateRepoStatus('üîÑ Loading...');
      
      const response = await fetch('https://api.github.com/user/repos?per_page=100&sort=updated', {
        headers: {
          'Authorization': `token ${accessToken}`,
          'Accept': 'application/vnd.github.v3+json'
        }
      });

      if (!response.ok) throw new Error('Failed to fetch repos');
      
      let allRepos = await response.json();
      
      if (repoFilter.length > 0) {
        repositories = allRepos.filter(repo => repoFilter.includes(repo.name));
        filterInfo.style.display = 'flex';
        filterCount.textContent = repositories.length;
      } else {
        repositories = allRepos;
        filterInfo.style.display = 'none';
      }
      
      displayRepositories();
      updateRepoStatus(`‚úÖ Loaded ${repositories.length} repos`);
    }

    function displayRepositories() {
      repoGrid.innerHTML = '';
      
      if (repositories.length === 0) {
        repoGrid.innerHTML = '<div class="empty-state"><p>‚ö†Ô∏è No repos found</p></div>';
        return;
      }
      
      repositories.forEach(repo => {
        const card = document.createElement('div');
        card.className = 'repo-card';
        card.innerHTML = `
          <div class="repo-name">${repo.name}</div>
          <div class="repo-description">${repo.description || 'No description'}</div>
          <div class="repo-stats">
            <span>‚≠ê ${repo.stargazers_count}</span>
            <span>üîÄ ${repo.forks_count}</span>
            <span>${repo.private ? 'üîí Private' : 'üåç Public'}</span>
          </div>
        `;
        
        card.addEventListener('click', () => selectRepository(repo, card));
        repoGrid.appendChild(card);
      });
    }

    async function selectRepository(repo, cardElement) {
      document.querySelectorAll('.repo-card').forEach(c => c.classList.remove('active'));
      cardElement.classList.add('active');
      
      selectedRepo = repo;
      await fetchJSONFiles(repo);
      fileSelector.style.display = 'block';
    }

    async function fetchJSONFiles(repo) {
      try {
        const response = await fetch(`https://api.github.com/repos/${repo.full_name}/git/trees/${repo.default_branch}?recursive=1`, {
          headers: {
            'Authorization': `token ${accessToken}`,
            'Accept': 'application/vnd.github.v3+json'
          }
        });

        if (!response.ok) throw new Error('Failed to fetch files');
        
        const data = await response.json();
        const jsonFiles = data.tree.filter(file => file.path.endsWith('.json'));
        
        fileSelect.innerHTML = '<option value="">-- Select a JSON file --</option>';
        jsonFiles.forEach(file => {
          const option = document.createElement('option');
          option.value = file.path;
          option.textContent = file.path;
          fileSelect.appendChild(option);
        });
      } catch (error) {
        console.error('Error:', error);
      }
    }

    fileSelect.addEventListener('change', async (e) => {
      selectedFile = e.target.value;
      if (selectedFile) {
        await loadFileData();
        mainContent.style.display = 'block';
      }
    });

    async function loadFileData() {
      try {
        updateStatus('üîÑ Loading...');
        
        const response = await fetch(
          `https://api.github.com/repos/${selectedRepo.full_name}/contents/${selectedFile}`,
          {
            headers: {
              'Authorization': `token ${accessToken}`,
              'Accept': 'application/vnd.github.v3+json'
            }
          }
        );

        if (!response.ok) throw new Error('Load failed');
        
        const data = await response.json();
        fileSha = data.sha;
        const content = atob(data.content);
        currentData = JSON.parse(content);
        
        displayData();
        rawJsonEditor.value = JSON.stringify(currentData, null, 2);
        updateStatus('‚úÖ Loaded');
        updateCurrentRepo();
        updateLastSync();
      } catch (error) {
        alert('‚ùå Error: ' + error.message);
      }
    }

    async function saveDataToGitHub(msg = 'Update') {
      try {
        updateStatus('üì§ Saving...');
        
        const content = btoa(unescape(encodeURIComponent(JSON.stringify(currentData, null, 2))));
        
        const response = await fetch(
          `https://api.github.com/repos/${selectedRepo.full_name}/contents/${selectedFile}`,
          {
            method: 'PUT',
            headers: {
              'Authorization': `token ${accessToken}`,
              'Accept': 'application/vnd.github.v3+json',
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ message: msg, content, sha: fileSha })
          }
        );

        if (!response.ok) throw new Error('Save failed');
        
        const result = await response.json();
        fileSha = result.content.sha;
        updateStatus('‚úÖ Saved');
        updateLastSync();
        return true;
      } catch (error) {
        alert('‚ùå Error: ' + error.message);
        return false;
      }
    }

    function displayData(searchTerm = '', highlightDeviceId = null) {
      dataList.innerHTML = '';
      
      // Convert to array format
      if (Array.isArray(currentData)) {
        allDataArray = currentData;
      } else if (currentData && typeof currentData === 'object') {
        allDataArray = Object.keys(currentData).map(key => ({
          id: key,
          ...currentData[key]
        }));
      } else {
        allDataArray = [];
      }
      
      // Calculate counts
      let totalKeys = allDataArray.length;
      let activeKeys = 0;
      let expiredKeys = 0;
      
      allDataArray.forEach(item => {
        if (isExpired(item.expirydate)) {
          expiredKeys++;
        } else {
          activeKeys++;
        }
      });
      
      // Update count info
      document.getElementById('keysCountInfo').textContent = 
        `Total: ${totalKeys} | Active: ${activeKeys} | Expired: ${expiredKeys}`;
      
      // Filter by status (all/active/expired)
      let statusFilteredArray = allDataArray;
      if (currentFilter === 'active') {
        statusFilteredArray = allDataArray.filter(item => !isExpired(item.expirydate));
      } else if (currentFilter === 'expired') {
        statusFilteredArray = allDataArray.filter(item => isExpired(item.expirydate));
      }
      
      // Filter by search term
      if (searchTerm) {
        filteredDataArray = statusFilteredArray.filter(item => {
          const deviceId = (item.device_id || item.id || '').toLowerCase();
          const user = (item.user || '').toLowerCase();
          const key = (item.key || '').toLowerCase();
          const search = searchTerm.toLowerCase();
          
          return deviceId.includes(search) || user.includes(search) || key.includes(search);
        });
      } else {
        filteredDataArray = statusFilteredArray;
      }
      
      if (filteredDataArray.length === 0) {
        dataList.innerHTML = '<div class="empty-state"><p>No keys found</p></div>';
        updatePositionInfo(0);
        return;
      }

      updatePositionInfo(filteredDataArray.length);

      filteredDataArray.forEach((item) => {
        const deviceId = item.device_id || item.id || 'Unknown';
        const expired = isExpired(item.expirydate);
        
        // Find original position in allDataArray
        const originalPosition = allDataArray.findIndex(originalItem => 
          (originalItem.device_id || originalItem.id) === deviceId
        ) + 1;
        
        const div = document.createElement('div');
        div.className = 'item';
        div.id = `item-${deviceId}`;
        
        if (expired) {
          div.classList.add('expired');
        }
        
        div.innerHTML = `
          <span class="position-badge">#${originalPosition}</span>
          <p><b>Device:</b> ${deviceId}</p>
          <p><b>User:</b> ${item.user || 'N/A'}</p>
          <p><b>Key:</b> ${item.key || 'N/A'}</p>
          <p><b>Expiry:</b> ${item.expirydate || 'N/A'}</p>
          <p><b>Offline:</b> ${item.Allowoffline !== undefined ? item.Allowoffline : 'N/A'}</p>
          <div class="btn-group">
            <button class="update" onclick="updateItem('${deviceId}', ${originalPosition})">‚úèÔ∏è Update</button>
            <button class="danger" onclick="deleteItem('${deviceId}')">üóë Delete</button>
          </div>
        `;
        dataList.appendChild(div);
        
        // Highlight and scroll to newly added/updated item
        if (highlightDeviceId && deviceId === highlightDeviceId) {
          setTimeout(() => {
            scrollToElement(div);
            highlightElement(div);
          }, 100);
        }
      });
    }

    function updatePositionInfo(totalKeys) {
      const positionInfo = document.getElementById('positionInfo');
      positionInfo.textContent = `(Total: ${totalKeys} keys)`;
    }

    // Search functionality
    searchInput.addEventListener('input', (e) => {
      displayData(e.target.value);
    });

    // Position search/autocomplete
    positionInput.addEventListener('input', (e) => {
      const value = e.target.value.toLowerCase();
      
      if (!value) {
        positionSuggestions.classList.remove('show');
        return;
      }

      // Check if it's a number
      const isNumber = /^\d+$/.test(value);
      
      if (isNumber) {
        // Just validate the position number
        const pos = parseInt(value);
        if (pos >= 1 && pos <= allDataArray.length + 1) {
          positionSuggestions.classList.remove('show');
        } else {
          showPositionError();
        }
      } else {
        // Search by user name
        const matches = allDataArray.filter(item => 
          (item.user || '').toLowerCase().includes(value)
        );
        
        if (matches.length > 0) {
          showPositionSuggestions(matches);
        } else {
          positionSuggestions.classList.remove('show');
        }
      }
    });

    function showPositionSuggestions(matches) {
      positionSuggestions.innerHTML = '';
      
      matches.forEach((item) => {
        const deviceId = item.device_id || item.id;
        
        // Find actual position in allDataArray
        const actualIndex = allDataArray.findIndex(d => {
          const dId = d.device_id || d.id;
          return dId === deviceId;
        }) + 1;
        
        const div = document.createElement('div');
        div.className = 'position-suggestion-item';
        div.innerHTML = `
          <span class="suggestion-position">#${actualIndex}</span>
          <span class="suggestion-user">${item.user || 'N/A'} (${deviceId})</span>
        `;
        
        div.addEventListener('click', () => {
          positionInput.value = actualIndex;
          positionSuggestions.classList.remove('show');
        });
        
        positionSuggestions.appendChild(div);
      });
      
      positionSuggestions.classList.add('show');
    }

    function showPositionError() {
      positionSuggestions.innerHTML = '<div class="position-suggestion-item" style="color: var(--danger);">Invalid position!</div>';
      positionSuggestions.classList.add('show');
    }

    // Click outside to close suggestions
    document.addEventListener('click', (e) => {
      if (!positionInput.contains(e.target) && !positionSuggestions.contains(e.target)) {
        positionSuggestions.classList.remove('show');
      }
    });

    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        // Skip if it's a filter tab (already handled)
        if (tab.classList.contains('filter-tab')) return;
        
        document.querySelectorAll('.tab:not(.filter-tab)').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(`tab-${tab.dataset.tab}`).classList.add('active');
      });
    });

    document.getElementById('saveBtn').addEventListener('click', async () => {
      const id = document.getElementById('deviceId').value.trim();
      const key = document.getElementById('key').value.trim();
      const expiry = document.getElementById('expiry').value.trim();
      const user = document.getElementById('username').value.trim();
      const allow = document.getElementById('allowOffline').checked;
      const positionValue = document.getElementById('positionInput').value.trim();

      if (!id || !key || !expiry || !user) {
        alert('‚ö†Ô∏è Fill all fields!');
        return;
      }

      let position = parseInt(positionValue);
      
      if (!position || position < 1 || position > allDataArray.length + 1) {
        alert('‚ö†Ô∏è Invalid position!');
        return;
      }

      const newEntry = { 
        device_id: id, 
        key, 
        expirydate: expiry, 
        user, 
        Allowoffline: allow 
      };

      let dataArray = [...allDataArray];

      if (currentUpdateId) {
        const index = dataArray.findIndex(item => 
          (item.device_id === currentUpdateId || item.id === currentUpdateId)
        );
        
        if (index !== -1) {
          dataArray.splice(index, 1);
        }
        
        dataArray.splice(position - 1, 0, newEntry);
      } else {
        dataArray.splice(position - 1, 0, newEntry);
      }

      // Convert back to original format
      if (Array.isArray(currentData)) {
        currentData = dataArray;
      } else {
        const newObj = {};
        dataArray.forEach(item => {
          const deviceId = item.device_id || item.id;
          newObj[deviceId] = {
            device_id: deviceId,
            key: item.key,
            expirydate: item.expirydate,
            user: item.user,
            Allowoffline: item.Allowoffline
          };
        });
        currentData = newObj;
      }

      const commitMsg = currentUpdateId ? 
        `Update key for ${id} at #${position}` : 
        `Add key for ${id} at #${position}`;
      
      if (await saveDataToGitHub(commitMsg)) {
        // Clear search to show all items
        searchInput.value = '';
        
        // Display data with highlight on the new/updated item
        displayData('', id);
        rawJsonEditor.value = JSON.stringify(currentData, null, 2);
        
        // Clear form
        document.getElementById('deviceId').value = '';
        document.getElementById('key').value = '';
        document.getElementById('expiry').value = '01-01-2026';
        document.getElementById('username').value = '';
        document.getElementById('allowOffline').checked = false;
        document.getElementById('positionInput').value = '';
        document.getElementById('cancelBtn').style.display = 'none';
        
        const actionMsg = currentUpdateId ? 'Updated' : 'Added';
        currentUpdateId = null;
        alert(`‚úÖ ${actionMsg} at #${position}!`);
      }
    });

    document.getElementById('cancelBtn').addEventListener('click', () => {
      document.getElementById('deviceId').value = '';
      document.getElementById('key').value = '';
      document.getElementById('expiry').value = '01-01-2026';
      document.getElementById('username').value = '';
      document.getElementById('allowOffline').checked = false;
      document.getElementById('positionInput').value = '';
      document.getElementById('cancelBtn').style.display = 'none';
      currentUpdateId = null;
    });

    window.updateItem = (id, currentPos) => {
      currentUpdateId = id;
      
      let item = null;
      
      if (Array.isArray(currentData)) {
        item = currentData.find(entry => 
          entry.device_id === id || entry.id === id
        );
      } else {
        item = currentData[id];
      }

      if (item) {
        document.getElementById('deviceId').value = item.device_id || id;
        document.getElementById('key').value = item.key || '';
        document.getElementById('expiry').value = item.expirydate || '';
        document.getElementById('username').value = item.user || '';
        document.getElementById('allowOffline').checked = item.Allowoffline || false;
        document.getElementById('positionInput').value = currentPos;
        document.getElementById('cancelBtn').style.display = 'inline-block';
        document.querySelector('.tab[data-tab="keys"]').click();
        window.scrollTo(0, 0);
      }
    };

    window.deleteItem = async (id) => {
      if (confirm(`Delete key for ${id}?`)) {
        if (Array.isArray(currentData)) {
          const index = currentData.findIndex(item => 
            item.device_id === id || item.id === id
          );
          if (index !== -1) {
            currentData.splice(index, 1);
          }
        } else {
          delete currentData[id];
        }
        
        if (await saveDataToGitHub(`Delete key for ${id}`)) {
          displayData();
          rawJsonEditor.value = JSON.stringify(currentData, null, 2);
          alert('üóë Deleted!');
        }
      }
    };

    document.getElementById('updateFromJsonBtn').addEventListener('click', async () => {
      try {
        const parsed = JSON.parse(rawJsonEditor.value.trim());
        if (confirm('Save JSON?')) {
          currentData = parsed;
          if (await saveDataToGitHub('Update from JSON')) {
            displayData();
            alert('‚úÖ Saved!');
          }
        }
      } catch (error) {
        alert('‚ùå Invalid JSON!');
      }
    });

    document.getElementById('formatJsonBtn').addEventListener('click', () => {
      try {
        rawJsonEditor.value = JSON.stringify(JSON.parse(rawJsonEditor.value.trim()), null, 2);
        alert('‚ú® Formatted!');
      } catch (e) {
        alert('‚ùå Invalid JSON!');
      }
    });

    document.getElementById('copyJsonBtn').addEventListener('click', () => {
      rawJsonEditor.select();
      document.execCommand('copy');
      alert('üìã Copied!');
    });

    document.getElementById('resetJsonBtn').addEventListener('click', () => {
      if (confirm('Reset?')) {
        rawJsonEditor.value = JSON.stringify(currentData, null, 2);
        alert('üîÑ Reset!');
      }
    });

    document.getElementById('refreshReposBtn').addEventListener('click', fetchRepositories);

    document.getElementById('filterBtn').addEventListener('click', () => {
      const current = localStorage.getItem('repo_filter');
      const filterText = current ? JSON.parse(current).join(', ') : '';
      
      const newFilter = prompt(
        'üìÅ Repository Filter\n\n' +
        'Comma or newline separated:\n' +
        'repo1, repo2, repo3\n\n' +
        'Leave empty for all',
        filterText
      );
      
      if (newFilter !== null) {
        if (newFilter.trim()) {
          repoFilter = newFilter.split(/[,\n]/).map(l => l.trim()).filter(l => l.length > 0);
          localStorage.setItem('repo_filter', JSON.stringify(repoFilter));
          alert(`‚úÖ Filter: ${repoFilter.length} repos`);
        } else {
          repoFilter = [];
          localStorage.removeItem('repo_filter');
          alert('‚úÖ Filter cleared!');
        }
        fetchRepositories();
      }
    });

    document.getElementById('logoutBtn').addEventListener('click', () => {
      if (confirm('Logout?')) {
        localStorage.removeItem('github_token');
        localStorage.removeItem('repo_filter');
        location.reload();
      }
    });

    function updateStatus(msg) {
      document.getElementById('syncStatus').innerHTML = msg;
    }

    function updateRepoStatus(msg) {
      document.getElementById('repoStatus').innerHTML = `<span>üìÅ</span><span>${msg}</span>`;
    }

    function updateCurrentRepo() {
      document.getElementById('currentRepo').textContent = `${selectedRepo.name} ‚Üí ${selectedFile}`;
    }

    function updateLastSync() {
      document.getElementById('lastSync').textContent = `Last: ${new Date().toLocaleTimeString('en-IN')}`;
    }
  </script>
</body>
</html>
