<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=700, initial-scale=0.7, maximum-scale=1.0, user-scalable=yes" />
  <title>üî• GitHub Admin Panel - Enhanced</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
    
    :root {
      --bg-primary: #0a0a0a;
      --bg-secondary: #1f1f1f;
      --bg-card: #1e1e1e;
      --bg-input: #2d2d2d;
      --bg-hover: #252525;
      --accent: #ffc107;
      --accent-hover: #ffb300;
      --accent-light: rgba(255, 193, 7, 0.1);
      --text-primary: #f5f5f5;
      --text-secondary: #aaa;
      --border: #333;
      --success: #4caf50;
      --danger: #e53935;
      --warning: #ff9800;
      --expired-bg: #3d1a1a;
      --expired-border: #8b2020;
    }

    [data-theme="blue"] {
      --bg-primary: #0a1929;
      --bg-secondary: #1a2332;
      --bg-card: #1e2a3a;
      --bg-input: #2d3748;
      --bg-hover: #334155;
      --accent: #2196f3;
      --accent-hover: #1976d2;
      --accent-light: rgba(33, 150, 243, 0.1);
      --border: #3d4a5c;
    }

    [data-theme="cyber"] {
      --bg-primary: #0a0e1a;
      --bg-secondary: #0d1117;
      --bg-card: #0d1117;
      --bg-input: #161b22;
      --bg-hover: #1c2128;
      --accent: #00ffff;
      --accent-hover: #00d4d4;
      --accent-light: rgba(0, 255, 255, 0.1);
      --border: #30363d;
      --success: #00ff00;
      --danger: #ff0080;
      --warning: #ffff00;
    }

    [data-theme="neon"] {
      --bg-primary: #0a0014;
      --bg-secondary: #120020;
      --bg-card: #1a0030;
      --bg-input: #220040;
      --bg-hover: #2a0050;
      --accent: #ff00ff;
      --accent-hover: #cc00cc;
      --accent-light: rgba(255, 0, 255, 0.1);
      --border: #4a0080;
      --success: #00ff88;
      --danger: #ff0066;
      --warning: #ffdd00;
    }

    [data-theme="terminal"] {
      --bg-primary: #000000;
      --bg-secondary: #0a0a0a;
      --bg-card: #0f0f0f;
      --bg-input: #1a1a1a;
      --bg-hover: #1f1f1f;
      --accent: #00ff00;
      --accent-hover: #00cc00;
      --accent-light: rgba(0, 255, 0, 0.1);
      --border: #00ff00;
      --success: #00ff00;
      --danger: #ff0000;
      --warning: #ffff00;
    }

    [data-theme="gold"] {
      --bg-primary: #0a0a0a;
      --bg-secondary: #1f1f1f;
      --bg-card: #1e1e1e;
      --bg-input: #2d2d2d;
      --bg-hover: #252525;
      --accent: #ffc107;
      --accent-hover: #ffb300;
      --accent-light: rgba(255, 193, 7, 0.1);
      --border: #333;
    }

    [data-theme="matrix"] {
      --bg-primary: #030b06;
      --bg-secondary: #021407;
      --bg-card: #020f08;
      --bg-input: #041b0c;
      --bg-hover: #052410;
      --accent: #00ff9c;
      --accent-hover: #00cc7a;
      --accent-light: rgba(0,255,156,.15);
      --border: #0f3;
      --success: #00ff9c;
      --danger: #ff1744;
      --warning: #ffd600;
    }
    
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, var(--bg-primary), var(--bg-secondary));
      color: var(--text-primary);
      min-height: 100vh;
      transition: all 0.5s ease;
    }

    body[data-theme="matrix"]::before {
      content: "";
      position: fixed;
      inset: 0;
      background: repeating-linear-gradient(180deg, rgba(0,255,140,.08) 0px, rgba(0,255,140,.02) 2px, transparent 4px, transparent 18px);
      animation: matrixScroll 12s linear infinite;
      pointer-events: none;
      z-index: -1;
    }

    @keyframes matrixScroll {
      from { background-position: 0 0; }
      to { background-position: 0 1000px; }
    }

    /* Cyber Hacker Theme - Animated Code Background */
    body[data-theme="cyber"]::before {
      content: "01001000 01100001 01100011 01101011 01100101 01110010 00100000 01001101 01101111 01100100 01100101 00100000 01000001 01100011 01110100 01101001 01110110 01100101 function hack() { console.log('ACCESS GRANTED'); } while(true) { decrypt(); } system.breach(); root@terminal:~$ sudo access mainframe CONNECTION ESTABLISHED >>> FIREWALL BYPASSED <<< def exploit(): return True class Cyber: def __init__(self): self.status = 'ACTIVE' import os, sys, socket KERNEL PANIC: SYSTEM COMPROMISED ";
      position: fixed;
      inset: 0;
      font-family: 'Courier New', monospace;
      font-size: 11px;
      color: rgba(0, 255, 255, 0.15);
      line-height: 1.8;
      overflow: hidden;
      white-space: pre-wrap;
      word-wrap: break-word;
      animation: cyberScroll 25s linear infinite;
      pointer-events: none;
      z-index: -1;
      padding: 20px;
      text-shadow: 0 0 5px rgba(0, 255, 255, 0.3);
    }

    @keyframes cyberScroll {
      from { transform: translateY(0); }
      to { transform: translateY(-50%); }
    }

    /* Neon Theme - Glowing Grid */
    body[data-theme="neon"]::before {
      content: "";
      position: fixed;
      inset: 0;
      background-image: 
        linear-gradient(rgba(255, 0, 255, 0.1) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255, 0, 255, 0.1) 1px, transparent 1px);
      background-size: 50px 50px;
      animation: neonGrid 20s linear infinite;
      pointer-events: none;
      z-index: -1;
    }

    @keyframes neonGrid {
      from { transform: perspective(500px) rotateX(60deg) translateY(0); }
      to { transform: perspective(500px) rotateX(60deg) translateY(50px); }
    }

    /* Terminal Theme - Scanlines */
    body[data-theme="terminal"]::before {
      content: "";
      position: fixed;
      inset: 0;
      background: repeating-linear-gradient(
        0deg,
        rgba(0, 255, 0, 0.05) 0px,
        rgba(0, 255, 0, 0.05) 1px,
        transparent 1px,
        transparent 2px
      );
      animation: scanlines 8s linear infinite;
      pointer-events: none;
      z-index: -1;
    }

    @keyframes scanlines {
      from { background-position: 0 0; }
      to { background-position: 0 100%; }
    }

    body[data-theme="terminal"]::after {
      content: "> SYSTEM_ACTIVE ‚ñà";
      position: fixed;
      bottom: 10px;
      left: 10px;
      font-family: 'Courier New', monospace;
      color: rgba(0, 255, 0, 0.5);
      font-size: 12px;
      animation: blink 1s step-end infinite;
      pointer-events: none;
      z-index: -1;
    }

    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }

    body[data-theme="matrix"] .item,
    body[data-theme="matrix"] .card {
      border: 1px solid #0f3;
      box-shadow: 0 0 20px rgba(0,255,160,.35), inset 0 0 15px rgba(0,255,160,.15);
    }

    body[data-theme="matrix"] input,
    body[data-theme="matrix"] textarea {
      background: #010a05;
      border: 1px solid #0f3;
      box-shadow: inset 0 0 10px rgba(0,255,160,.25);
    }

    body[data-theme="matrix"] button {
      background: #010a05;
      border: 1px solid #0f3;
      color: #00ff9c;
      box-shadow: 0 0 10px rgba(0,255,160,.4);
    }

    body[data-theme="matrix"] button:hover {
      background: #020;
      box-shadow: 0 0 20px rgba(0,255,160,.8);
    }

    body[data-theme="matrix"] .position-badge {
      background: #00ff9c;
      color: #011;
      box-shadow: 0 0 12px #00ff9c;
    }

    /* Cyber Theme Effects */
    body[data-theme="cyber"] .item,
    body[data-theme="cyber"] .card {
      border: 1px solid #00ffff;
      box-shadow: 0 0 15px rgba(0,255,255,.25), inset 0 0 10px rgba(0,255,255,.1);
    }

    body[data-theme="cyber"] input,
    body[data-theme="cyber"] textarea {
      background: #0a1520;
      border: 1px solid #00ffff;
      box-shadow: inset 0 0 8px rgba(0,255,255,.2);
    }

    body[data-theme="cyber"] .position-badge {
      background: #00ffff;
      color: #000;
      box-shadow: 0 0 10px #00ffff;
    }

    /* Neon Theme Effects */
    body[data-theme="neon"] .item,
    body[data-theme="neon"] .card {
      border: 1px solid #ff00ff;
      box-shadow: 0 0 20px rgba(255,0,255,.3), inset 0 0 15px rgba(255,0,255,.1);
    }

    body[data-theme="neon"] input,
    body[data-theme="neon"] textarea {
      background: #1a0030;
      border: 1px solid #ff00ff;
      box-shadow: inset 0 0 10px rgba(255,0,255,.2);
    }

    body[data-theme="neon"] .position-badge {
      background: #ff00ff;
      color: #000;
      box-shadow: 0 0 15px #ff00ff;
    }

    /* Terminal Theme Effects */
    body[data-theme="terminal"] .item,
    body[data-theme="terminal"] .card {
      border: 1px solid #00ff00;
      box-shadow: 0 0 10px rgba(0,255,0,.3);
      font-family: 'Courier New', monospace;
    }

    body[data-theme="terminal"] input,
    body[data-theme="terminal"] textarea {
      background: #000;
      border: 1px solid #00ff00;
      color: #00ff00;
      font-family: 'Courier New', monospace;
    }

    body[data-theme="terminal"] .position-badge {
      background: #00ff00;
      color: #000;
      box-shadow: 0 0 10px #00ff00;
      font-family: 'Courier New', monospace;
    }
    
    header {
      background: var(--bg-card);
      padding: 15px 25px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 2px solid var(--border);
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      position: sticky;
      top: 0;
      z-index: 100;
      transition: all 0.5s ease;
    }
    
    header h1 {
      color: var(--accent);
      font-size: 1.5em;
      display: flex;
      align-items: center;
      gap: 10px;
      transition: color 0.5s ease;
    }
    
    .github-logo {
      width: 32px;
      height: 32px;
      fill: var(--accent);
      transition: fill 0.5s ease;
    }
    
    .user-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 2px solid var(--accent);
      transition: border-color 0.5s ease;
    }
    
    .user-details {
      text-align: right;
    }
    
    .user-name {
      font-weight: 600;
      color: var(--accent);
      font-size: 0.95em;
      transition: color 0.5s ease;
    }
    
    .user-username {
      font-size: 0.8em;
      color: var(--text-secondary);
    }
    
    .logout-btn, .theme-btn {
      background: var(--danger);
      color: white;
      border: none;
      border-radius: 6px;
      padding: 8px 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .theme-btn {
      background: var(--accent);
      color: #111;
      transition: all 0.5s ease;
    }
    
    .logout-btn:hover { background: #c62828; transform: scale(1.05); }
    .theme-btn:hover { background: var(--accent-hover); }
    
    main {
      max-width: 1200px;
      margin: 30px auto;
      padding: 20px;
    }
    
    .card {
      background: var(--bg-card);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
      margin-bottom: 25px;
      transition: all 0.5s ease;
      border: 1px solid var(--border);
    }
    
    .card h3 {
      color: var(--accent);
      margin-bottom: 15px;
      font-size: 1.3em;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      user-select: none;
      transition: color 0.5s ease;
    }

    .card h3:hover {
      color: var(--accent-hover);
    }

    .collapse-icon {
      transition: transform 0.3s ease;
      font-size: 0.8em;
    }

    .collapse-icon.collapsed {
      transform: rotate(-90deg);
    }

    .collapsible-content {
      max-height: 2000px;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    .collapsible-content.collapsed {
      max-height: 0;
    }
    
    .login-card {
      max-width: 650px;
      margin: 50px auto;
    }
    
    .login-card p {
      color: var(--text-secondary);
      margin: 15px 0;
      line-height: 1.6;
    }
    
    .login-card ol {
      color: var(--text-secondary);
      margin: 15px 0 15px 20px;
      line-height: 1.8;
    }
    
    .login-card ol a {
      color: var(--accent);
      text-decoration: none;
      transition: color 0.5s ease;
    }
    
    .token-input-group {
      background: var(--bg-hover);
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
      transition: background 0.5s ease;
    }
    
    .token-input-group input, .token-input-group textarea {
      width: 100%;
      padding: 14px;
      background: var(--bg-input);
      color: var(--text-primary);
      border: 2px solid var(--border);
      border-radius: 8px;
      font-size: 14px;
      outline: none;
      transition: all 0.5s ease;
    }
    
    .token-input-group input[type="password"] {
      font-family: 'Courier New', monospace;
    }
    
    .token-input-group textarea {
      font-family: 'Poppins', sans-serif;
      min-height: 100px;
      resize: vertical;
    }
    
    .token-input-group input:focus, .token-input-group textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 10px var(--accent-light);
    }
    
    .token-input-group label {
      display: block;
      color: var(--accent);
      font-weight: 600;
      margin-bottom: 10px;
      transition: color 0.5s ease;
    }
    
    .login-btn {
      background: #238636;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 14px 28px;
      font-size: 1.1em;
      font-weight: 600;
      cursor: pointer;
      display: block;
      width: 100%;
      margin-top: 20px;
      transition: all 0.3s ease;
    }
    
    .login-btn:hover {
      background: #2ea043;
      transform: translateY(-2px);
    }
    
    .repo-filter-info {
      background: var(--accent-light);
      border: 1px solid var(--accent);
      padding: 12px 15px;
      border-radius: 8px;
      margin-bottom: 15px;
      font-size: 0.9em;
      color: var(--text-secondary);
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.5s ease;
    }
    
    .repo-filter-info strong {
      color: var(--accent);
      transition: color 0.5s ease;
    }
    
    .repo-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    
    .repo-card {
      background: var(--bg-input);
      padding: 15px;
      border-radius: 8px;
      border: 2px solid var(--border);
      cursor: pointer;
      transition: all 0.5s ease;
    }
    
    .repo-card:hover {
      border-color: var(--accent);
      transform: translateY(-2px);
      box-shadow: 0 4px 15px var(--accent-light);
    }
    
    .repo-card.active {
      border-color: var(--accent);
      background: var(--accent-light);
      box-shadow: 0 0 20px var(--accent-light);
    }
    
    .repo-name {
      font-weight: 600;
      color: var(--accent);
      margin-bottom: 5px;
      font-size: 0.95em;
      transition: color 0.5s ease;
    }
    
    .repo-description {
      font-size: 0.85em;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }
    
    .repo-stats {
      display: flex;
      gap: 15px;
      font-size: 0.8em;
      color: #888;
    }
    
    .file-selector select {
      width: 100%;
      padding: 12px;
      background: var(--bg-input);
      color: var(--text-primary);
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 1em;
      cursor: pointer;
      outline: none;
      margin-top: 15px;
      transition: all 0.5s ease;
    }
    
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      border-bottom: 2px solid var(--border);
      transition: border-color 0.5s ease;
    }
    
    .tab {
      padding: 12px 24px;
      background: transparent;
      border: none;
      color: var(--text-secondary);
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: all 0.3s ease;
    }
    
    .tab:hover { color: var(--accent); }
    .tab.active { 
      color: var(--accent); 
      border-bottom-color: var(--accent);
    }
    
    .tab-content { display: none; }
    .tab-content.active { display: block; animation: fadeIn 0.3s ease; }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes highlightPulse {
      0%, 100% { box-shadow: 0 0 0 0 var(--accent); }
      50% { box-shadow: 0 0 20px 5px var(--accent-light); }
    }

    .item.highlight {
      animation: highlightPulse 2s ease-in-out 3;
      border-color: var(--accent) !important;
      background: var(--accent-light) !important;
    }
    
    input, button, select, textarea {
      padding: 10px;
      margin: 8px 6px;
      border-radius: 8px;
      border: none;
      font-size: 15px;
      transition: all 0.5s ease;
    }
    
    input, textarea {
      background: var(--bg-input);
      color: var(--text-primary);
      border: 1px solid var(--border);
      outline: none;
    }
    
    input { 
      width: calc(100% - 12px);
      max-width: 100%;
    }
    
    textarea {
      width: calc(100% - 12px);
      min-height: 600px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      resize: vertical;
      line-height: 1.5;
    }
    
    button { cursor: pointer; font-weight: 600; }
    button.save { background: #007bff; color: #fff; }
    button.update { background: #43a047; color: #fff; }
    button.danger { background: var(--danger); color: #fff; }
    button.sync { background: var(--warning); color: #fff; }
    button.disable { background: #666; color: #fff; }
    
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 15px;
    }
    
    .item {
      background: var(--bg-hover);
      padding: 15px;
      border-radius: 10px;
      border: 2px solid var(--border);
      position: relative;
      transition: all 0.5s ease;
      scroll-margin-top: 100px;
    }

    .item:hover {
      border-color: var(--accent);
      transform: translateY(-2px);
    }

    .item.expired {
      background: var(--expired-bg);
      border-color: var(--expired-border);
    }

    .item.expired:hover {
      border-color: var(--danger);
    }

    .item.expired .position-badge {
      background: var(--danger);
    }

    .item.expired::before {
      content: "‚ö†Ô∏è EXPIRED";
      position: absolute;
      top: 10px;
      right: 10px;
      background: var(--danger);
      color: white;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 700;
      z-index: 1;
    }
    
    .item p { margin: 6px 0; font-size: 14px; color: #ddd; }
    .item b { 
      color: var(--accent);
      transition: color 0.5s ease;
    }
    
    .position-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      background: var(--accent);
      color: #111;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      transition: all 0.5s ease;
    }

    .item.expired .position-badge {
      top: 40px;
    }
    
    .btn-group {
      margin-top: 10px;
      display: flex;
      justify-content: space-between;
      gap: 8px;
    }
    
    .status-bar {
      background: var(--bg-input);
      padding: 12px 18px;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 10px;
      transition: all 0.5s ease;
      border: 1px solid var(--border);
    }
    
    .status-bar .status {
      color: var(--success);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .status-bar .actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .info-box {
      background: var(--accent-light);
      border: 1px solid var(--accent);
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
      transition: all 0.5s ease;
    }
    
    .info-box p { color: var(--text-secondary); margin: 8px 0; line-height: 1.6; }
    
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #666;
      grid-column: 1 / -1;
    }

    .search-box {
      position: relative;
      margin: 15px 6px;
    }

    .search-box input {
      width: 100%;
      padding-left: 40px;
      background: var(--bg-input);
      border: 2px solid var(--border);
    }

    .search-box input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 10px var(--accent-light);
    }

    .search-icon {
      position: absolute;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-secondary);
      pointer-events: none;
    }

    .position-input-group {
      display: flex;
      gap: 10px;
      align-items: center;
      margin: 10px 6px;
      flex-wrap: wrap;
    }

    .position-input-group label {
      display: none;
    }

    .position-input-group input {
      flex: 1;
      min-width: 200px;
      margin: 0;
    }

    .position-suggestions {
      position: absolute;
      background: var(--bg-input);
      border: 2px solid var(--accent);
      border-radius: 8px;
      max-height: 200px;
      overflow-y: auto;
      z-index: 1000;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
      display: none;
      transition: all 0.5s ease;
    }

    .position-suggestions.show {
      display: block;
    }

    .position-suggestion-item {
      padding: 10px 15px;
      cursor: pointer;
      transition: background 0.2s ease;
      border-bottom: 1px solid var(--border);
    }

    .position-suggestion-item:hover {
      background: var(--bg-hover);
    }

    .position-suggestion-item:last-child {
      border-bottom: none;
    }

    .suggestion-position {
      color: var(--accent);
      font-weight: 600;
      margin-right: 10px;
      transition: color 0.5s ease;
    }

    .suggestion-user {
      color: var(--text-secondary);
      font-size: 0.9em;
    }

    .user-suggestions {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: var(--bg-input);
      border: 2px solid var(--accent);
      border-radius: 8px;
      max-height: 180px;
      overflow-y: auto;
      z-index: 9999;
      display: none;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    }

    .user-suggestions div {
      padding: 10px 14px;
      cursor: pointer;
      transition: background 0.2s ease;
      border-bottom: 1px solid var(--border);
    }

    .user-suggestions div:hover {
      background: var(--bg-hover);
      color: var(--accent);
    }

    .user-suggestions div:last-child {
      border-bottom: none;
    }

    .date-input-wrapper {
      display: flex;
      align-items: center;
      gap: 8px;
      width: 100%;
      margin: 0;
    }

    .date-input-wrapper input {
      flex: 1;
      margin: 0;
      width: 100%;
      min-width: 120px;
    }

    .quick-date-buttons {
      display: flex;
      gap: 4px;
    }

 
.quick-date-btn{
  background: var(--accent);
  color:#111;
  border:none;
  border-radius:10px;
  padding:12px 22px;     /* üëà ‡§¨‡§°‡§º‡§æ size */
  font-size:16px;       /* üëà ‡§¨‡§°‡§º‡§æ text */
  font-weight:700;
  min-width:72px;       /* üëà ‡§¨‡§∞‡§æ‡§¨‡§∞ ‡§ö‡•å‡§°‡§º‡§æ‡§à */
  cursor:pointer;
  transition:.25s;
  box-shadow:0 0 18px var(--accent-light);
}

    .quick-date-btn:hover {
      background: var(--accent-hover);
      transform: scale(1.05);
    }

    .quick-date-btn:active {
      transform: scale(0.95);
    }

    .theme-modal {
      display: none;
      position: fixed;
      z-index: 2000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.7);
      animation: fadeIn 0.3s ease;
    }

    .theme-modal-content {
      background: var(--bg-card);
      margin: 10% auto;
      padding: 30px;
      border: 2px solid var(--accent);
      border-radius: 15px;
      width: 90%;
      max-width: 500px;
      animation: slideDown 0.3s ease;
      transition: all 0.5s ease;
    }

    @keyframes slideDown {
      from { transform: translateY(-50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .theme-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .theme-option {
      padding: 20px;
      border-radius: 10px;
      border: 3px solid transparent;
      cursor: pointer;
      text-align: center;
      transition: all 0.3s ease;
      font-weight: 600;
    }

    .theme-option:hover {
      transform: scale(1.05);
    }

    .theme-option.active {
      border-color: white;
      box-shadow: 0 0 20px rgba(255,255,255,0.3);
    }

    .theme-gold { background: linear-gradient(135deg, #ffc107, #ffb300); color: #111; }
    .theme-blue { background: linear-gradient(135deg, #2196f3, #1976d2); color: white; }
    .theme-matrix { background: linear-gradient(135deg, #00ff9c, #00cc7a); color: #111; }
    .theme-cyber { background: linear-gradient(135deg, #00ffff, #00aaaa); color: #111; }
    .theme-neon { background: linear-gradient(135deg, #ff00ff, #cc00cc); color: white; }
    .theme-terminal { background: linear-gradient(135deg, #00ff00, #00aa00); color: #000; }
    
    footer {
      text-align: center;
      color: #888;
      padding: 20px;
      font-size: 0.9em;
    }

    .tap-copy {
      cursor: pointer;
    }

    .tap-copy span {
      transition: .3s;
    }

    .tap-copy:hover span {
      color: var(--accent);
    }

    /* ========================================
       FLOATING ACTION BUTTON & POPUP MODAL
    ======================================== */

    #floatingAddBtn {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 24px;
      width: 64px;
      height: 64px;
      border-radius: 50%;
      font-size: 32px;
      font-weight: 300;
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-hover) 100%);
      color: #111;
      border: none;
      cursor: pointer;
      box-shadow: 
        0 6px 12px rgba(0,0,0,0.3),
        0 3px 6px rgba(255, 193, 7, 0.2),
        0 0 0 0 var(--accent);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9998;
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      animation: fabPulse 3s ease-in-out infinite;
      padding: 0;
    }

    @keyframes fabPulse {
      0%, 100% {
        box-shadow: 
          0 6px 12px rgba(0,0,0,0.3),
          0 3px 6px rgba(255, 193, 7, 0.2),
          0 0 0 0 var(--accent);
      }
      50% {
        box-shadow: 
          0 6px 12px rgba(0,0,0,0.3),
          0 3px 6px rgba(255, 193, 7, 0.2),
          0 0 0 8px transparent;
      }
    }

    #floatingAddBtn:hover {
      transform: translateX(-50%) scale(1.12) rotate(90deg);
      box-shadow: 
        0 10px 20px rgba(0,0,0,0.4),
        0 5px 10px rgba(255, 193, 7, 0.3),
        0 0 20px rgba(255, 193, 7, 0.2);
      animation: none;
    }

    #floatingAddBtn:active {
      transform: translateX(-50%) scale(1.05) rotate(90deg);
      box-shadow: 
        0 3px 6px rgba(0,0,0,0.3),
        0 2px 4px rgba(255, 193, 7, 0.2);
    }

    .modal-bg {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.75);
  backdrop-filter: blur(4px);
  display: none;

  /* üëá CENTER ‡§∏‡•á ‡§π‡§ü‡§æ‡§ï‡§∞ ‡§ä‡§™‡§∞ ‡§≤‡•á ‡§ú‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è */
  align-items: flex-start;
  justify-content: center;

  padding-top: 10vh;   /* ‡§ú‡§ø‡§§‡§®‡§æ ‡§ä‡§™‡§∞ ‡§ö‡§æ‡§π‡§ø‡§è ‡§â‡§§‡§®‡§æ ‡§¨‡§¢‡§º‡§æ/‡§ò‡§ü‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•ã */
  padding-left: 20px;
  padding-right: 20px;
  padding-bottom: 20px;

  z-index: 10000;
  overflow-y: auto;
   animation: overlayFadeIn 0.3s ease;
    }

    @keyframes overlayFadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-bg.show {
      display: flex;
    }

    .modal-box {
      width: 100%;
      max-width: 580px;
      background: #1a1a1a;
      border-radius: 16px;
      box-shadow: 0 24px 48px rgba(0,0,0,0.9), 0 0 0 1px rgba(255, 193, 7, 0.2);
      animation: dialogSlideUp 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      transition: all 0.5s ease;
      overflow: hidden;
    }

    @keyframes dialogSlideUp {
      from {
        opacity: 0;
        transform: translateY(40px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .modal-header {
      padding: 20px 24px;
      background: #1f1f1f;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #2a2a2a;
    }

    .modal-title {
      font-size: 1.25em;
      font-weight: 600;
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: 10px;
      letter-spacing: 0.3px;
    }

    .modal-close {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      background: #2a2a2a;
      border: 1px solid #3a3a3a;
      color: #888;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
      margin: 0;
      padding: 0;
      font-weight: 400;
    }

    .modal-close:hover {
      background: #ff4444;
      color: white;
      border-color: #ff4444;
      transform: scale(1.05);
    }

    .modal-close:active {
      transform: scale(0.95);
    }

    .modal-body {
      padding: 24px;
      background: #1a1a1a;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .input-label {
      color: var(--accent);
      font-weight: 500;
      font-size: 0.9em;
      display: flex;
      align-items: center;
      gap: 6px;
      letter-spacing: 0.3px;
    }

    .checkbox-label {
      color: #ddd;
      font-weight: 400;
      font-size: 0.95em;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      user-select: none;
      padding: 12px;
      background: #242424;
      border-radius: 8px;
      border: 1px solid #333;
      transition: all 0.2s ease;
    }

    .checkbox-label:hover {
      background: #2a2a2a;
      border-color: var(--accent);
    }

    .checkbox-label input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
      accent-color: var(--accent);
    }

    .modal-input {
      width: 100%;
      padding: 12px 14px;
      background: #242424;
      border: 1px solid #333;
      color: #f5f5f5;
      border-radius: 8px;
      font-size: 0.95em;
      outline: none;
      transition: all 0.2s ease;
      margin: 0;
      font-family: 'Poppins', sans-serif;
    }

    .modal-input::placeholder {
      color: #666;
    }

    .modal-input:focus {
      background: #2a2a2a;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(255, 193, 7, 0.1);
    }

    .modal-save-btn {
      flex: 1;
      background: linear-gradient(135deg, var(--accent), var(--accent-hover));
      color: #111;
      border: none;
      padding: 14px 24px;
      border-radius: 10px;
      font-weight: 700;
      font-size: 0.95em;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 4px 12px rgba(255, 193, 7, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin: 0;
      font-family: 'Poppins', sans-serif;
    }

    .modal-save-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      background: linear-gradient(135deg, #999, #888);
      box-shadow: none;
      transform: none !important;
    }

    .modal-save-btn:not(:disabled):hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(255, 193, 7, 0.3);
    }

    .modal-save-btn:not(:disabled):active {
      transform: translateY(0);
    }

    .spinner {
      width: 16px;
      height: 16px;
      border: 2px solid #111;
      border-top-color: transparent;
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
      display: inline-block;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .modal-cancel-btn {
      flex: 0 0 auto;
      min-width: 200px;
      background: #2a2a2a;
      color: #888;
      border: 1px solid #3a3a3a;
      padding: 14px 20px;
      border-radius: 10px;
      font-weight: 600;
      font-size: 0.95em;
      cursor: pointer;
      transition: all 0.2s ease;
      margin: 0;
      font-family: 'Poppins', sans-serif;
    }

    .modal-cancel-btn:hover {
      background: #ff4444;
      color: white;
      border-color: #ff4444;
      box-shadow: 0 4px 12px rgba(255, 68, 68, 0.3);
      transform: translateY(-2px);
    }

    .modal-cancel-btn:active {
      transform: translateY(0);
    }

    .modal-body input[type="text"],
    .modal-body input[type="checkbox"] {
    }

    .modal-body label {
    }

    #topBtn {
      position: fixed;
      right: 20px;
      bottom: 24px;
      width: 56px;
      height: 56px;
      border-radius: 16px;
      background: linear-gradient(135deg, #2a2a2a, #1f1f1f);
      border: 1px solid #3a3a3a;
      color: var(--accent);
      font-size: 28px;
      font-weight: 300;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(255, 193, 7, 0.1);
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      padding: 0;
      margin: 0;
    }

    #topBtn:hover {
      transform: translateY(-4px) scale(1.05);
      box-shadow: 0 10px 28px rgba(0, 0, 0, 0.5), 0 0 0 2px var(--accent);
      background: linear-gradient(135deg, var(--accent), var(--accent-hover));
      color: #111;
      border-color: var(--accent);
    }

    #topBtn:active {
      transform: translateY(-2px) scale(1);
    }

    @media (max-width: 600px) {
      #floatingAddBtn {
        width: 60px;
        height: 60px;
        font-size: 28px;
        bottom: 20px;
      }

      #topBtn {
        width: 52px;
        height: 52px;
        font-size: 24px;
        right: 16px;
        bottom: 20px;
        border-radius: 14px;
      }

      .modal-bg {
        padding: 20px 12px;
        align-items: flex-start;
        padding-top: 40px;
      }

      .modal-box {
        max-width: 100%;
        border-radius: 12px;
      }

      .modal-header {
        padding: 16px 20px;
      }

      .modal-body {
        padding: 20px;
      }

      .modal-title {
        font-size: 1.1em;
      }

      .modal-cancel-btn {
        min-width: 120px;
      }
    }
    .row-inputs{
  display: flex;
  gap: 12px;
}

.field-wrap{
  flex: 1;
  position: relative; /* dropdown anchor */
}
.offline-row{
  display: flex;
  align-items: center;
  gap: 12px;
  width: 100%;
}

/* Buttons group = 2x width */
.offline-btn-group{
  flex: 2;
  display: flex;
  gap: 8px;
}

/* ‚àí1 / +1 equal */
.adjust-btn{
  flex: 1;
  padding: 14px 0;
  font-size: 18px;
}

/* ‚úÖ Allow Offline ko visually bada karo */
.offline-label{
  flex: 1.5;                 /* üëà pehle 1 tha, ab bada */
  margin: 0;
  white-space: nowrap;
  padding: 14px 16px;        /* üëà box size bada */
  justify-content: center;   /* üëà center align */
}
  </style>
</head>
<body data-theme="gold">
  <header>
    <h1>
      <svg class="github-logo" viewBox="0 0 16 16">
        <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
      </svg>
      GitHub Admin Panel
    </h1>
    <div class="user-info" id="userInfo" style="display:none;">
      <div class="user-details">
        <div class="user-name" id="userName"></div>
        <div class="user-username" id="userUsername"></div>
      </div>
      <img class="user-avatar" id="userAvatar" src="" alt="Avatar">
      <button class="theme-btn" id="themeBtn">üé® Theme</button>
      <button class="logout-btn" id="logoutBtn">üö™ Logout</button>
    </div>
  </header>

  <main>
    <!-- Login Section -->
    <div id="loginSection">
      <div class="card login-card">
        <h3>üîê GitHub Access Token Login</h3>
        
        <div class="info-box">
          <p><strong>‚ö†Ô∏è Token Generate Steps:</strong></p>
        </div>
        
        <ol>
          <li>GitHub: <a href="https://github.com/settings/tokens" target="_blank">https://github.com/settings/tokens</a></li>
          <li><strong>"Generate new token (classic)"</strong></li>
          <li>Permissions: <strong>‚úÖ repo</strong></li>
          <li>Generate & copy token</li>
        </ol>
        
        <div class="token-input-group">
          <label>üîë GitHub Personal Access Token:</label>
          <input type="password" id="tokenInput" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx" />
        </div>
        
        <div class="token-input-group">
          <label>üìÅ Repository Filter (optional):</label>
          <textarea id="repoFilterInput" placeholder="Repository names (comma or new line separated):

repo1, repo2, repo3

or

repo1
repo2
repo3"></textarea>
        </div>
        
        <button class="login-btn" id="loginBtn">üöÄ Connect to GitHub</button>
      </div>
    </div>

    <!-- Main Panel -->
    <div id="mainPanel" style="display:none;">
      <div class="card">
        <h3 onclick="toggleCollapse('repoSection')">
          üìÅ Select Repository & File
          <span class="collapse-icon" id="repoSectionIcon">‚ñº</span>
        </h3>
        
        <div class="collapsible-content" id="repoSection">
          <div class="repo-filter-info" id="filterInfo" style="display:none;">
            <div>
              <strong>üîç Filter:</strong> <span id="filterCount">0</span> repos
            </div>
          </div>
          
          <div class="status-bar">
            <div class="status" id="repoStatus">‚ö° Ready</div>
            <div class="actions">
              <button class="sync" id="filterBtn" style="margin: 0;">üîç Filter</button>
              <button class="sync" id="refreshReposBtn" style="margin: 0;">üîÑ Refresh</button>
            </div>
          </div>
          
          <div class="repo-grid" id="repoGrid"></div>
          
          <div class="file-selector" id="fileSelector" style="display:none;">
            <label style="color: var(--accent); font-weight: 600; display: block; margin: 10px 6px;">Select JSON File:</label>
            <select id="fileSelect">
              <option value="">-- Select a JSON file --</option>
            </select>
          </div>
        </div>
      </div>

      <div class="card" id="mainContent" style="display:none;">
        <div class="status-bar">
          <div class="status" id="syncStatus">‚ö° Ready</div>
          <div style="color: var(--text-secondary); font-size: 0.9em;">
            <span id="currentRepo">No repo selected</span> ‚Ä¢ 
            <span id="lastSync">Not synced</span>
          </div>
        </div>

        <div class="tabs">
          <button class="tab active" data-tab="keys">üìú Active Keys</button>
          <button class="tab" data-tab="editor">üìù Raw JSON Editor</button>
        </div>

        <div class="tab-content active" id="tab-keys">
          <div class="card" style="background: var(--bg-hover);">
            <h3>üìã License Keys</h3>
            
            <div style="margin: 15px 6px; color: var(--text-secondary); font-size: 0.95em; font-weight: 600;">
              <span id="keysCountInfo">Total: 0 | Active: 0 | Expired: 0</span>
            </div>
            
            <div class="tabs" style="margin-top: 10px;">
              <button class="tab active filter-tab" data-filter="all">üìú All Keys</button>
              <button class="tab filter-tab" data-filter="active">‚úÖ Active</button>
              <button class="tab filter-tab" data-filter="expired">‚ö†Ô∏è Expired</button>
            </div>
            
            <div class="search-box">
              <span class="search-icon">üîç</span>
              <input type="text" id="searchInput" placeholder="Search by Device ID, User, or Key...">
            </div>
            
            <div id="dataList" class="grid"></div>
          </div>
        </div>

        <div class="tab-content" id="tab-editor">
          <div class="card" style="background: var(--bg-hover);">
            <h3>üìù Edit Raw JSON</h3>
            <textarea id="rawJsonEditor" placeholder="JSON data will appear here..."></textarea>
            <div style="display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap;">
              <button class="update" id="updateFromJsonBtn">üì§ Save JSON</button>
              <button class="sync" id="formatJsonBtn">‚ú® Format</button>
              <button class="sync" id="copyJsonBtn">üìã Copy</button>
              <button class="danger" id="resetJsonBtn">üîÑ Reset</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Floating Add Button -->
  <button id="floatingAddBtn" onclick="openKeyModal()">‚ûï</button>

  <!-- Top Scroll Button -->
  <button id="topBtn" onclick="topScroll()">‚áß</button>

  <!-- Key Add/Update Modal -->
  <div class="modal-bg" id="keyModal">
    <div class="modal-box">
      <div class="modal-header">
        <div class="modal-title" id="modalTitle">‚ûï Add License Key</div>
        <button class="modal-close" onclick="closeKeyModal()">√ó</button>
      </div>
      
      <div class="modal-body">
        <div style="display: flex; flex-direction: column; gap: 18px;">
          
          <!-- Device ID -->
          <div class="input-group">
            <label class="input-label">üì± Device ID</label>
            <input id="deviceId" placeholder="Enter device ID" type="text" class="modal-input" />
          </div>
          
         <div class="input-group">
  <label class="input-label">üîë License Key</label>

  <div style="display:flex; gap:10px;">
    <input id="key" placeholder="Enter or generate license key"
           type="text"
           class="modal-input"
           style="flex:1;" />

    <button type="button"
        onclick="generateRandomKey()"
        class="quick-date-btn"
        style="
          padding:14px 26px;
          min-width:120px;
          font-size:20px;
        ">
  üé≤
</button>
  </div>

</div>
          
          <!-- Expiry Date -->
          <div class="input-group">
            <label class="input-label">üìÖ Expiry Date</label>
            <div class="date-input-wrapper" style="margin: 0; width: 100%;">
              <input id="expiry" placeholder="dd-mm-yyyy" type="text" class="modal-input" style="margin: 0;" />
              <div class="quick-date-buttons">
                <button class="quick-date-btn" onclick="setQuickDate(7)">7d</button>
                <button class="quick-date-btn" onclick="setQuickDate(15)">15d</button>
                <button class="quick-date-btn" onclick="setQuickDate(30)">30d</button>
              </div>
            </div>
          </div>
<div class="input-group">
  <div class="offline-row">

    <!-- -1 / +1 Buttons -->
    <div class="offline-btn-group">
      <button type="button"
              class="quick-date-btn adjust-btn"
              onclick="adjustExpiry(-1)">
        ‚àí1
      </button>

      <button type="button"
              class="quick-date-btn adjust-btn"
              onclick="adjustExpiry(1)">
        +1
      </button>
    </div>

    <!-- Allow Offline -->
    <label class="checkbox-label offline-label">
      <input id="allowOffline" type="checkbox" />
      <span>‚úì Allow Offline</span>
    </label>

  </div>
</div>          
<div class="input-group">

  <div class="row-inputs">

    <!-- Username -->
    <div class="field-wrap">
      <label class="input-label">üë§ User Name</label>
      <input id="username"
             placeholder="Enter user name"
             type="text"
             class="modal-input" />

      <div id="userSuggestions" class="user-suggestions"></div>
    </div>

    <!-- Position -->
    <div class="field-wrap">
      <label class="input-label">üìç Position</label>
      <input id="positionInput"
             placeholder="Enter position"
             type="text"
             class="modal-input"
             autocomplete="off" />

      <div id="positionSuggestions" class="position-suggestions"></div>
    </div>

  </div>
  </div>
  

  <span id="positionInfo"
        style="color:#666;font-size:12px;margin-top:6px;">
    (Total: 0 keys)
  </span>

</div>
          
                 
        
        <!-- Action Buttons -->
        <div style="display: flex; gap: 12px; margin-top: 24px;">
          <button class="modal-save-btn" id="saveBtn">
            üíæ Save to GitHub
          </button>
          <button class="modal-cancel-btn" onclick="closeKeyModal()">
            ‚úï Cancel
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Theme Modal -->
  <div id="themeModal" class="theme-modal">
    <div class="theme-modal-content">
      <h3 style="color: var(--accent); margin-bottom: 20px;">üé® Choose Theme</h3>
      <div class="theme-grid">
        <div class="theme-option theme-gold" data-theme="gold">üåü Gold</div>
        <div class="theme-option theme-blue" data-theme="blue">üíô Blue</div>
        <div class="theme-option theme-matrix" data-theme="matrix">üü¢ Matrix</div>
        <div class="theme-option theme-terminal" data-theme="terminal">üíö Terminal</div>
      </div>
      <div style="display: flex; justify-content: center;">
        <button class="danger" onclick="closeThemeModal()" style="width: 100%; margin-top: 20px;">Close</button>
      </div>
    </div>
  </div>

  <footer>¬© 2025 GitHub Admin Panel | By OP Mods</footer>

  <script>
    let accessToken = null;
    let userData = null;
    let repositories = [];
    let repoFilter = [];
    let selectedRepo = null;
    let selectedFile = null;
    let currentData = {};
    let currentUpdateId = null;
    let fileSha = null;
    let allDataArray = [];
    let filteredDataArray = [];
    let currentFilter = 'all';
    let repoCloseTimer = null;

    const loginSection = document.getElementById('loginSection');
    const mainPanel = document.getElementById('mainPanel');
    const userInfo = document.getElementById('userInfo');
    const repoGrid = document.getElementById('repoGrid');
    const fileSelector = document.getElementById('fileSelector');
    const fileSelect = document.getElementById('fileSelect');
    const mainContent = document.getElementById('mainContent');
    const dataList = document.getElementById('dataList');
    const rawJsonEditor = document.getElementById('rawJsonEditor');
    const tokenInput = document.getElementById('tokenInput');
    const repoFilterInput = document.getElementById('repoFilterInput');
    const filterInfo = document.getElementById('filterInfo');
    const filterCount = document.getElementById('filterCount');
    const searchInput = document.getElementById('searchInput');
    const positionInput = document.getElementById('positionInput');
    const positionSuggestions = document.getElementById('positionSuggestions');
    const expiryInput = document.getElementById('expiry');
    const userInput = document.getElementById('username');
    const userSuggestions = document.getElementById('userSuggestions');

    // Set default expiry to tomorrow
    function setTomorrowExpiry() {
      const d = new Date();
      d.setDate(d.getDate() + 1);
      const dd = String(d.getDate()).padStart(2, '0');
      const mm = String(d.getMonth() + 1).padStart(2, '0');
      const yy = d.getFullYear();
      expiryInput.value = `${dd}-${mm}-${yy}`;
    }

    setTomorrowExpiry();

    // Quick Date Selection
    window.setQuickDate = function(days) {
      const today = new Date();
      today.setDate(today.getDate() + days);
      
      const day = String(today.getDate()).padStart(2, '0');
      const month = String(today.getMonth() + 1).padStart(2, '0');
      const year = today.getFullYear();
      
      expiryInput.value = `${day}-${month}-${year}`;
      
      expiryInput.style.borderColor = 'var(--success)';
      setTimeout(() => {
        expiryInput.style.borderColor = '';
      }, 500);
    };

    // Modal functions
    window.openKeyModal = function() {
      document.getElementById('keyModal').classList.add('show');
      document.body.style.overflow = 'hidden';
      
      // Scroll to top smoothly when opening modal
      window.scrollTo({ top: 0, behavior: 'smooth' });
      
      if (!currentUpdateId) {
        document.getElementById('modalTitle').innerHTML = '‚ûï Add License Key';
        setTomorrowExpiry();
      }
    };

    window.closeKeyModal = function() {
      document.getElementById('keyModal').classList.remove('show');
      document.body.style.overflow = '';
      
      // Only reset form when actually closing (not when opening for update)
      setTimeout(() => {
        if (!document.getElementById('keyModal').classList.contains('show')) {
          document.getElementById('deviceId').value = '';
          document.getElementById('key').value = '';
          setTomorrowExpiry();
          document.getElementById('username').value = '';
          document.getElementById('allowOffline').checked = false;
          document.getElementById('positionInput').value = '';
          document.getElementById('modalTitle').innerHTML = '‚ûï Add License Key';
          currentUpdateId = null;
        }
      }, 300);
    };

    // Top scroll function
    window.topScroll = function() {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    };

    // User suggestions
    userInput.addEventListener('input', () => {
      const v = userInput.value.toLowerCase();
      userSuggestions.innerHTML = '';

      if (!v) {
        userSuggestions.style.display = 'none';
        return;
      }

      const matches = allDataArray
        .map(x => x.user)
        .filter(u => u && u.toLowerCase().includes(v));

      if (matches.length === 0) {
        userSuggestions.style.display = 'none';
        return;
      }

      [...new Set(matches)].slice(0, 6).forEach(name => {
        const d = document.createElement('div');
        d.textContent = name;
        d.onclick = () => {
          userInput.value = name;
          userSuggestions.style.display = 'none';
        };
        userSuggestions.appendChild(d);
      });

      userSuggestions.style.display = 'block';
    });

    // Check if date is expired
    function isExpired(expiryDate) {
      if (!expiryDate) return false;
      
      try {
        const parts = expiryDate.split('-');
        if (parts.length !== 3) return false;
        
        const day = parseInt(parts[0]);
        const month = parseInt(parts[1]) - 1;
        const year = parseInt(parts[2]);
        
        const expiry = new Date(year, month, day);
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        return expiry <= today;
      } catch (e) {
        return false;
      }
    }

    function scrollToElement(element) {
      element.scrollIntoView({ 
        behavior: 'smooth', 
        block: 'center'
      });
    }

    function highlightElement(element) {
      element.classList.add('highlight');
      setTimeout(() => {
        element.classList.remove('highlight');
      }, 6000);
    }

    // Theme functionality
    function loadTheme() {
      const savedTheme = localStorage.getItem('theme') || 'gold';
      document.body.dataset.theme = savedTheme;
      updateActiveTheme(savedTheme);
    }

    function updateActiveTheme(theme) {
      document.querySelectorAll('.theme-option').forEach(opt => {
        opt.classList.remove('active');
        if (opt.dataset.theme === theme) {
          opt.classList.add('active');
        }
      });
    }

    document.getElementById('themeBtn').addEventListener('click', () => {
      document.getElementById('themeModal').style.display = 'block';
    });

    window.closeThemeModal = function() {
      document.getElementById('themeModal').style.display = 'none';
    };

    document.querySelectorAll('.theme-option').forEach(option => {
      option.addEventListener('click', () => {
        const theme = option.dataset.theme;
        document.body.dataset.theme = theme;
        localStorage.setItem('theme', theme);
        updateActiveTheme(theme);
      });
    });

    window.toggleCollapse = function(sectionId) {
      const section = document.getElementById(sectionId);
      const icon = document.getElementById(sectionId + 'Icon');
      
      section.classList.toggle('collapsed');
      icon.classList.toggle('collapsed');
    };

    // Filter tabs
    document.querySelectorAll('.filter-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        currentFilter = tab.dataset.filter;
        displayData(searchInput.value);
      });
    });

    loadTheme();
    checkExistingSession();

    function checkExistingSession() {
      const token = localStorage.getItem('github_token');
      const filter = localStorage.getItem('repo_filter');
      
      if (token) {
        accessToken = token;
        if (filter) {
          repoFilter = JSON.parse(filter);
        }
        initializeApp();
      }
    }

    document.getElementById('loginBtn').addEventListener('click', async () => {
      const token = tokenInput.value.trim();
      
      if (!token) {
        alert('‚ö†Ô∏è Please enter GitHub token!');
        return;
      }
      
      if (!token.startsWith('ghp_') && !token.startsWith('github_pat_')) {
        alert('‚ö†Ô∏è Invalid token format!');
        return;
      }
      
      const filterText = repoFilterInput.value.trim();
      if (filterText) {
        repoFilter = filterText.split(/[,\n]/).map(line => line.trim()).filter(line => line.length > 0);
        localStorage.setItem('repo_filter', JSON.stringify(repoFilter));
      } else {
        repoFilter = [];
        localStorage.removeItem('repo_filter');
      }
      
      accessToken = token;
      localStorage.setItem('github_token', accessToken);
      
      try {
        await initializeApp();
      } catch (error) {
        alert('‚ùå Invalid token: ' + error.message);
        localStorage.removeItem('github_token');
        accessToken = null;
      }
    });

    async function initializeApp() {
      try {
        await fetchUserData();
        await fetchRepositories();
        
        loginSection.style.display = 'none';
        mainPanel.style.display = 'block';
        userInfo.style.display = 'flex';
        
        // Show FAB and hide scroll button
        document.getElementById('floatingAddBtn').style.display = 'flex';
        document.getElementById('topBtn').style.display = 'none';
      } catch (error) {
        console.error('Init error:', error);
        throw error;
      }
    }

    async function fetchUserData() {
      const response = await fetch('https://api.github.com/user', {
        headers: {
          'Authorization': `token ${accessToken}`,
          'Accept': 'application/vnd.github.v3+json'
        }
      });

      if (!response.ok) throw new Error('Failed to fetch user');
      
      userData = await response.json();
      document.getElementById('userName').textContent = userData.name || userData.login;
      document.getElementById('userUsername').textContent = '@' + userData.login;
      document.getElementById('userAvatar').src = userData.avatar_url;
    }

    async function fetchRepositories() {
      updateRepoStatus('üîÑ Loading...');
      
      const response = await fetch('https://api.github.com/user/repos?per_page=100&sort=updated', {
        headers: {
          'Authorization': `token ${accessToken}`,
          'Accept': 'application/vnd.github.v3+json'
        }
      });

      if (!response.ok) throw new Error('Failed to fetch repos');
      
      let allRepos = await response.json();
      
      if (repoFilter.length > 0) {
        repositories = allRepos.filter(repo => repoFilter.includes(repo.name));
        filterInfo.style.display = 'flex';
        filterCount.textContent = repositories.length;
      } else {
        repositories = allRepos;
        filterInfo.style.display = 'none';
      }
      
      displayRepositories();
      updateRepoStatus(`‚úÖ Loaded ${repositories.length} repos`);
    }

    function displayRepositories() {
      repoGrid.innerHTML = '';
      
      if (repositories.length === 0) {
        repoGrid.innerHTML = '<div class="empty-state"><p>‚ö†Ô∏è No repos found</p></div>';
        return;
      }
      
      repositories.forEach(repo => {
        const card = document.createElement('div');
        card.className = 'repo-card';
        card.innerHTML = `
          <div class="repo-name">${repo.name}</div>
          <div class="repo-description">${repo.description || 'No description'}</div>
          <div class="repo-stats">
            <span>‚≠ê ${repo.stargazers_count}</span>
            <span>üîÄ ${repo.forks_count}</span>
            <span>${repo.private ? 'üîí Private' : 'üåç Public'}</span>
          </div>
        `;
        
        card.addEventListener('click', () => selectRepository(repo, card));
        repoGrid.appendChild(card);
      });
    }

    async function selectRepository(repo, cardElement) {
      document.querySelectorAll('.repo-card').forEach(c => c.classList.remove('active'));
      cardElement.classList.add('active');
      
      selectedRepo = repo;
      selectedFile = null;
      await fetchJSONFiles(repo);
      fileSelector.style.display = 'block';
    }

    async function fetchJSONFiles(repo) {
      try {
        const response = await fetch(`https://api.github.com/repos/${repo.full_name}/git/trees/${repo.default_branch}?recursive=1`, {
          headers: {
            'Authorization': `token ${accessToken}`,
            'Accept': 'application/vnd.github.v3+json'
          }
        });

        if (!response.ok) throw new Error('Failed to fetch files');
        
        const data = await response.json();
        const jsonFiles = data.tree.filter(file => file.path.endsWith('.json'));
        
        fileSelect.innerHTML = '<option value="">-- Select a JSON file --</option>';

        jsonFiles.forEach(file => {
          const option = document.createElement('option');
          option.value = file.path;
          option.textContent = file.path;
          fileSelect.appendChild(option);
        });

        if (!selectedFile && jsonFiles.length > 0) {
          fileSelect.value = jsonFiles[0].path;
          selectedFile = jsonFiles[0].path;
          await loadFileData();
          mainContent.style.display = 'block';
        }
      } catch (error) {
        console.error('Error:', error);
      }
    }

    fileSelect.addEventListener('change', async (e) => {
      selectedFile = e.target.value;
      if (selectedFile) {
        await loadFileData();
        mainContent.style.display = 'block';
        scheduleRepoDrawerClose();
      }
    });

    function scheduleRepoDrawerClose() {
      if (repoCloseTimer) clearTimeout(repoCloseTimer);

      repoCloseTimer = setTimeout(() => {
        const sec = document.getElementById('repoSection');
        const icon = document.getElementById('repoSectionIcon');

        if (sec && !sec.classList.contains('collapsed')) {
          sec.classList.add('collapsed');
          icon.classList.add('collapsed');
        }
      }, 3000);
    }

    async function loadFileData() {
      try {
        updateStatus('üîÑ Loading...');
        
        const response = await fetch(
          `https://api.github.com/repos/${selectedRepo.full_name}/contents/${selectedFile}`,
          {
            headers: {
              'Authorization': `token ${accessToken}`,
              'Accept': 'application/vnd.github.v3+json'
            }
          }
        );

        if (!response.ok) throw new Error('Load failed');
        
        const data = await response.json();
        fileSha = data.sha;
        const content = atob(data.content);
        currentData = JSON.parse(content);
        
        displayData();
        rawJsonEditor.value = JSON.stringify(currentData, null, 2);
        updateStatus('‚úÖ Loaded');
        updateCurrentRepo();
        updateLastSync();
        scheduleRepoDrawerClose();
      } catch (error) {
        alert('‚ùå Error: ' + error.message);
      }
    }

    async function saveDataToGitHub(msg = 'Update') {
      try {
        updateStatus('üì§ Saving...');
        
        const content = btoa(unescape(encodeURIComponent(JSON.stringify(currentData, null, 2))));
        
        const response = await fetch(
          `https://api.github.com/repos/${selectedRepo.full_name}/contents/${selectedFile}`,
          {
            method: 'PUT',
            headers: {
              'Authorization': `token ${accessToken}`,
              'Accept': 'application/vnd.github.v3+json',
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ message: msg, content, sha: fileSha })
          }
        );

        if (!response.ok) throw new Error('Save failed');
        
        const result = await response.json();
        fileSha = result.content.sha;
        updateStatus('‚úÖ Saved');
        updateLastSync();
        return true;
      } catch (error) {
        alert('‚ùå Error: ' + error.message);
        return false;
      }
    }

    function displayData(searchTerm = '', highlightDeviceId = null) {
      dataList.innerHTML = '';
      
      if (Array.isArray(currentData)) {
        allDataArray = currentData;
      } else if (currentData && typeof currentData === 'object') {
        allDataArray = Object.keys(currentData).map(key => ({
          id: key,
          ...currentData[key]
        }));
      } else {
        allDataArray = [];
      }
      
      let totalKeys = allDataArray.length;
      let activeKeys = 0;
      let expiredKeys = 0;
      
      allDataArray.forEach(item => {
        if (isExpired(item.expirydate)) {
          expiredKeys++;
        } else {
          activeKeys++;
        }
      });
      
      document.getElementById('keysCountInfo').textContent = 
        `Total: ${totalKeys} | Active: ${activeKeys} | Expired: ${expiredKeys}`;
      
      let statusFilteredArray = allDataArray;
      if (currentFilter === 'active') {
        statusFilteredArray = allDataArray.filter(item => !isExpired(item.expirydate));
      } else if (currentFilter === 'expired') {
        statusFilteredArray = allDataArray.filter(item => isExpired(item.expirydate));
      }
      
      if (searchTerm) {
        filteredDataArray = statusFilteredArray.filter(item => {
          const deviceId = (item.device_id || item.id || '').toLowerCase();
          const user = (item.user || '').toLowerCase();
          const key = (item.key || '').toLowerCase();
          const search = searchTerm.toLowerCase();
          
          return deviceId.includes(search) || user.includes(search) || key.includes(search);
        });
      } else {
        filteredDataArray = statusFilteredArray;
      }
      
      if (filteredDataArray.length === 0) {
        dataList.innerHTML = `
          <div class="empty-state">
            <p style="margin-bottom: 16px;">No keys found</p>
            <button onclick="openKeyModal()" style="
              padding: 14px 28px;
              background: var(--accent);
              border: none;
              border-radius: 30px;
              font-weight: 600;
              color: #111;
              box-shadow: 0 0 20px var(--accent-light);
              cursor: pointer;
              transition: all 0.3s ease;
            ">
              ‚ûï Add New Key
            </button>
          </div>`;
        updatePositionInfo(0);
        return;
      }

      updatePositionInfo(filteredDataArray.length);

      filteredDataArray.forEach((item) => {
        const deviceId = item.device_id || item.id || 'Unknown';
        const expired = isExpired(item.expirydate);
        
        const originalPosition = allDataArray.findIndex(originalItem => 
          (originalItem.device_id || originalItem.id) === deviceId
        ) + 1;
        
        const div = document.createElement('div');
        div.className = 'item';
        div.id = `item-${deviceId}`;
        
        if (expired) {
          div.classList.add('expired');
        }
        
        div.innerHTML = `
          <span class="position-badge">#${originalPosition}</span>
          <p><b>Device:</b> ${deviceId}</p>
          <p><b>User:</b> ${item.user || 'N/A'}</p>
          <p class="tap-copy" onclick="copyKey('${item.key || ''}')">
            <b>Key:</b> <span>${item.key || 'N/A'}</span>
          </p>
          <p><b>Expiry:</b> ${item.expirydate || 'N/A'}</p>
          <p><b>Offline:</b> ${item.Allowoffline !== undefined ? item.Allowoffline : 'N/A'}</p>
          <div class="btn-group">
            <button class="update" onclick="updateItem('${deviceId}', ${originalPosition})">‚úèÔ∏è Update</button>
            <button class="disable" onclick="disableItem('${deviceId}')">üö´ Disable</button>
            <button class="danger" onclick="deleteItem('${deviceId}')">üóë Delete</button>
          </div>
        `;
        dataList.appendChild(div);
        
        if (highlightDeviceId && deviceId === highlightDeviceId) {
          setTimeout(() => {
            scrollToElement(div);
            highlightElement(div);
          }, 100);
        }
      });
    }

    function updatePositionInfo(totalKeys) {
      const positionInfo = document.getElementById('positionInfo');
      positionInfo.textContent = `(Total: ${totalKeys} keys)`;
    }

    searchInput.addEventListener('input', (e) => {
      displayData(e.target.value);
    });

    positionInput.addEventListener('input', (e) => {
      const value = e.target.value.toLowerCase();
      
      if (!value) {
        positionSuggestions.classList.remove('show');
        return;
      }

      const isNumber = /^\d+$/.test(value);
      
      if (isNumber) {
        const pos = parseInt(value);
        if (pos >= 1 && pos <= allDataArray.length + 1) {
          positionSuggestions.classList.remove('show');
        } else {
          showPositionError();
        }
      } else {
        const matches = allDataArray.filter(item => 
          (item.user || '').toLowerCase().includes(value)
        );
        
        if (matches.length > 0) {
          showPositionSuggestions(matches);
        } else {
          positionSuggestions.classList.remove('show');
        }
      }
    });

    function showPositionSuggestions(matches) {
      positionSuggestions.innerHTML = '';
      
      matches.forEach((item) => {
        const deviceId = item.device_id || item.id;
        
        const actualIndex = allDataArray.findIndex(d => {
          const dId = d.device_id || d.id;
          return dId === deviceId;
        }) + 1;
        
        const div = document.createElement('div');
        div.className = 'position-suggestion-item';
        div.innerHTML = `
          <span class="suggestion-position">#${actualIndex}</span>
          <span class="suggestion-user">${item.user || 'N/A'} (${deviceId})</span>
        `;
        
        div.addEventListener('click', () => {
          positionInput.value = actualIndex;
          positionSuggestions.classList.remove('show');
        });
        
        positionSuggestions.appendChild(div);
      });
      
      positionSuggestions.classList.add('show');
    }

    function showPositionError() {
      positionSuggestions.innerHTML = '<div class="position-suggestion-item" style="color: var(--danger);">Invalid position!</div>';
      positionSuggestions.classList.add('show');
    }

    document.addEventListener('click', (e) => {
      if (!positionInput.contains(e.target) && !positionSuggestions.contains(e.target)) {
        positionSuggestions.classList.remove('show');
      }
      if (!userInput.contains(e.target) && !userSuggestions.contains(e.target)) {
        userSuggestions.style.display = 'none';
      }
    });

    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        if (tab.classList.contains('filter-tab')) return;
        
        document.querySelectorAll('.tab:not(.filter-tab)').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(`tab-${tab.dataset.tab}`).classList.add('active');
      });
    });

    document.getElementById('saveBtn').addEventListener('click', async () => {
      const saveBtn = document.getElementById('saveBtn');
      const id = document.getElementById('deviceId').value.trim();
      const key = document.getElementById('key').value.trim();
      const expiry = document.getElementById('expiry').value.trim();
      const user = document.getElementById('username').value.trim();
      const allow = document.getElementById('allowOffline').checked;
      const positionValue = document.getElementById('positionInput').value.trim();

      if (!id || !key || !expiry || !user) {
        alert('‚ö†Ô∏è Fill all fields!');
        return;
      }

      let position = parseInt(positionValue);
      
      if (!position || position < 1 || position > allDataArray.length + 1) {
        alert('‚ö†Ô∏è Invalid position!');
        return;
      }

      // Disable button and show saving state
      saveBtn.disabled = true;
      const originalHTML = saveBtn.innerHTML;
      saveBtn.innerHTML = '<span class="spinner"></span> Saving...';

      const newEntry = { 
        device_id: id, 
        key, 
        expirydate: expiry, 
        user, 
        Allowoffline: allow 
      };

      let dataArray = [...allDataArray];

      if (currentUpdateId) {
        const index = dataArray.findIndex(item => 
          (item.device_id === currentUpdateId || item.id === currentUpdateId)
        );
        
        if (index !== -1) {
          dataArray.splice(index, 1);
        }
        
        dataArray.splice(position - 1, 0, newEntry);
      } else {
        dataArray.splice(position - 1, 0, newEntry);
      }

      if (Array.isArray(currentData)) {
        currentData = dataArray;
      } else {
        const newObj = {};
        dataArray.forEach(item => {
          const deviceId = item.device_id || item.id;
          newObj[deviceId] = {
            device_id: deviceId,
            key: item.key,
            expirydate: item.expirydate,
            user: item.user,
            Allowoffline: item.Allowoffline
          };
        });
        currentData = newObj;
      }

      const commitMsg = currentUpdateId ? 
        `Update key for ${id} at #${position}` : 
        `Add key for ${id} at #${position}`;
      
      const saveResult = await saveDataToGitHub(commitMsg);
      
      // Re-enable button
      saveBtn.disabled = false;
      saveBtn.innerHTML = originalHTML;
      
      if (saveResult) {
        searchInput.value = '';
        displayData('', id);
        rawJsonEditor.value = JSON.stringify(currentData, null, 2);
        
        // Reset form
        document.getElementById('deviceId').value = '';
        document.getElementById('key').value = '';
        setTomorrowExpiry();
        document.getElementById('username').value = '';
        document.getElementById('allowOffline').checked = false;
        document.getElementById('positionInput').value = '';
        
        const actionMsg = currentUpdateId ? 'Updated' : 'Added';
        currentUpdateId = null;
        
        // Reset modal title
        document.getElementById('modalTitle').innerHTML = '‚ûï Add License Key';
        
        closeKeyModal();
        alert(`‚úÖ ${actionMsg} at #${position}!`);
      }
    });

    window.updateItem = (id, currentPos) => {
      console.log('Update clicked for:', id, 'at position:', currentPos);
      currentUpdateId = id;
      
      let item = null;
      
      if (Array.isArray(currentData)) {
        item = currentData.find(entry => 
          entry.device_id === id || entry.id === id
        );
      } else {
        item = currentData[id];
      }

      console.log('Found item:', item);

      if (item) {
        document.getElementById('deviceId').value = item.device_id || id;
        document.getElementById('key').value = item.key || '';
        document.getElementById('expiry').value = item.expirydate || '';
        document.getElementById('username').value = item.user || '';
        document.getElementById('allowOffline').checked = item.Allowoffline || false;
        document.getElementById('positionInput').value = currentPos;
        document.getElementById('modalTitle').innerHTML = '‚úèÔ∏è Update License Key';
        
        console.log('Opening modal...');
        openKeyModal();
      } else {
        console.error('Item not found!');
      }
    };

    window.deleteItem = async (id) => {
      if (confirm(`Delete key for ${id}?`)) {
        if (Array.isArray(currentData)) {
          const index = currentData.findIndex(item => 
            item.device_id === id || item.id === id
          );
          if (index !== -1) {
            currentData.splice(index, 1);
          }
        } else {
          delete currentData[id];
        }
        
        if (await saveDataToGitHub(`Delete key for ${id}`)) {
          displayData();
          rawJsonEditor.value = JSON.stringify(currentData, null, 2);
          alert('üóë Deleted!');
        }
      }
    };

    window.disableItem = async (id) => {
      if (confirm(`Disable key for ${id}? (Expiry will be set to 01-01-20)`)) {
        let dataArray = [...allDataArray];
        
        const index = dataArray.findIndex(item => 
          (item.device_id === id || item.id === id)
        );
        
        if (index !== -1) {
          const currentExpiry = dataArray[index].expirydate || '01-01-2026';
          const parts = currentExpiry.split('-');
          
          const newExpiry = `${parts[0]}-${parts[1]}-20`;
          dataArray[index].expirydate = newExpiry;
          
          if (Array.isArray(currentData)) {
            currentData = dataArray;
          } else {
            const newObj = {};
            dataArray.forEach(item => {
              const deviceId = item.device_id || item.id;
              newObj[deviceId] = {
                device_id: deviceId,
                key: item.key,
                expirydate: item.expirydate,
                user: item.user,
                Allowoffline: item.Allowoffline
              };
            });
            currentData = newObj;
          }
          
          if (await saveDataToGitHub(`Disable key for ${id}`)) {
            displayData();
            rawJsonEditor.value = JSON.stringify(currentData, null, 2);
            alert('üö´ Disabled! Expiry set to ' + newExpiry);
          }
        }
      }
    };

    document.getElementById('updateFromJsonBtn').addEventListener('click', async () => {
      try {
        const parsed = JSON.parse(rawJsonEditor.value.trim());
        if (confirm('Save JSON?')) {
          currentData = parsed;
          if (await saveDataToGitHub('Update from JSON')) {
            displayData();
            alert('‚úÖ Saved!');
          }
        }
      } catch (error) {
        alert('‚ùå Invalid JSON!');
      }
    });

    document.getElementById('formatJsonBtn').addEventListener('click', () => {
      try {
        rawJsonEditor.value = JSON.stringify(JSON.parse(rawJsonEditor.value.trim()), null, 2);
        alert('‚ú® Formatted!');
      } catch (e) {
        alert('‚ùå Invalid JSON!');
      }
    });

    document.getElementById('copyJsonBtn').addEventListener('click', () => {
      rawJsonEditor.select();
      document.execCommand('copy');
      alert('üìã Copied!');
    });

    document.getElementById('resetJsonBtn').addEventListener('click', () => {
      if (confirm('Reset?')) {
        rawJsonEditor.value = JSON.stringify(currentData, null, 2);
        alert('üîÑ Reset!');
      }
    });

    document.getElementById('refreshReposBtn').addEventListener('click', fetchRepositories);

    document.getElementById('filterBtn').addEventListener('click', () => {
      const current = localStorage.getItem('repo_filter');
      const filterText = current ? JSON.parse(current).join(', ') : '';
      
      const newFilter = prompt(
        'üìÅ Repository Filter\n\n' +
        'Comma or newline separated:\n' +
        'repo1, repo2, repo3\n\n' +
        'Leave empty for all',
        filterText
      );
      
      if (newFilter !== null) {
        if (newFilter.trim()) {
          repoFilter = newFilter.split(/[,\n]/).map(l => l.trim()).filter(l => l.length > 0);
          localStorage.setItem('repo_filter', JSON.stringify(repoFilter));
          alert(`‚úÖ Filter: ${repoFilter.length} repos`);
        } else {
          repoFilter = [];
          localStorage.removeItem('repo_filter');
          alert('‚úÖ Filter cleared!');
        }
        fetchRepositories();
      }
    });

    document.getElementById('logoutBtn').addEventListener('click', () => {
      if (confirm('Logout?')) {
        localStorage.removeItem('github_token');
        localStorage.removeItem('repo_filter');
        location.reload();
      }
    });

    function updateStatus(msg) {
      document.getElementById('syncStatus').innerHTML = msg;
    }

    function updateRepoStatus(msg) {
      document.getElementById('repoStatus').innerHTML = `<span>üìÅ</span><span>${msg}</span>`;
    }
    
    window.copyKey = function(key) {
      navigator.clipboard.writeText(key);
      alert("‚úÖ Key copied!");
    }
    
    function updateCurrentRepo() {
      document.getElementById('currentRepo').textContent = `${selectedRepo.name} ‚Üí ${selectedFile}`;
    }

    function updateLastSync() {
      document.getElementById('lastSync').textContent = `Last: ${new Date().toLocaleTimeString('en-IN')}`;
    }

    // Scroll button visibility
    window.addEventListener('scroll', () => {
      const topBtn = document.getElementById('topBtn');
      
      if (mainPanel.style.display === 'block' && window.scrollY > 250) {
        topBtn.style.display = 'flex';
      } else {
        topBtn.style.display = 'none';
      }
    });
    function generateRandomKey() {
  const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
  const existingKeys = allDataArray.map(x => x.key); // already saved keys

  let newKey = "";
  let lengthOptions = [11, 12, 13];

  do {
    const len = lengthOptions[Math.floor(Math.random() * lengthOptions.length)];
    newKey = "";

    for (let i = 0; i < len; i++) {
      newKey += chars.charAt(Math.floor(Math.random() * chars.length));
    }

  } while (existingKeys.includes(newKey));

  const keyInput = document.getElementById("key");
  keyInput.value = newKey;

  // visual feedback
  keyInput.style.borderColor = "var(--success)";
  setTimeout(() => keyInput.style.borderColor = "", 600);
}
window.adjustExpiry = function(days) {
  const input = document.getElementById('expiry');
  if (!input.value) return;

  const parts = input.value.split('-');
  if (parts.length !== 3) return;

  const day = parseInt(parts[0], 10);
  const month = parseInt(parts[1], 10) - 1;
  const year = parseInt(parts[2], 10);

  const d = new Date(year, month, day);
  if (isNaN(d.getTime())) return;

  d.setDate(d.getDate() + days);

  const dd = String(d.getDate()).padStart(2, '0');
  const mm = String(d.getMonth() + 1).padStart(2, '0');
  const yy = d.getFullYear();

  input.value = `${dd}-${mm}-${yy}`;

  // visual feedback
  input.style.borderColor = 'var(--accent)';
  setTimeout(() => input.style.borderColor = '', 400);
};
  </script>
</body>
</html>
